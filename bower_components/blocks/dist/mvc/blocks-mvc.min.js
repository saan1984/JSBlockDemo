!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=b(a,!0):b(a)}("undefined"!=typeof window?window:this,function(a,b){function c(a,b,d,e,g){if(g!==!1&&(g=!0),a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof k&&(a=a._wrapped),b instanceof k&&(b=b._wrapped);var h=f.call(a);if(h!=f.call(b))return!1;switch(h){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0===a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var i=d.length;i--;)if(d[i]==a)return e[i]==b;var j=a.constructor,l=b.constructor;if(j!==l&&!(k.isFunction(j)&&j instanceof j&&k.isFunction(l)&&l instanceof l)&&"constructor"in a&&"constructor"in b)return!1;d.push(a),e.push(b);var m=0,n=!0;if("[object Array]"==h){if(m=a.length,n=m==b.length)for(;m--&&(n=g?c(a[m],b[m],d,e,g):a[m]===b[m]););}else{for(var o in a)if(k.has(a,o)&&(m++,!(n=k.has(b,o)&&(g?c(a[o],b[o],d,e,g):a[o]===b[o]))))break;if(n){for(o in b)if(k.has(b,o)&&!m--)break;n=!m}}return d.pop(),e.pop(),n}function d(a,b){var c,d,e=this.__Class__;return k.isString(a)?d=e.prototype[a]:(b=a,d=e),this.__Class__=e.prototype.__Class__,c=d.apply(this,b||[]),this.__Class__=e,c}function e(a,b){if(null!=b){var c=a;a=function(a,d,e){return c.call(b,a,d,e)}}return a}var f=Object.prototype.toString,g=Array.prototype.slice,h=Object.prototype.hasOwnProperty,i={},j={},k=function(a){return j.expressionsCreated?0===arguments.length?j.staticExpression:j.createExpression(a):a};k.version="0.3.2",k.core=j,k.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[1]||{},h=2),"object"==typeof g||k.isFunction(g)||(g={});i>h;h++)if(null!=(e=arguments[h]))for(d in e)a=g[d],c=e[d],g!==c&&(j&&c&&(k.isPlainObject(c)||(b=k.isArray(c)))?(b?(b=!1,f=a&&k.isArray(a)?a:[]):f=a&&k.isPlainObject(a)?a:{},g[d]=k.extend(j,f,c)):g[d]=c);return g},k.each=function(a,b,c){if(null!=a){var d=a.length,f=-1,g="number"==typeof d;if(b=e(b,c),g)for(;++f<d&&b(a[f],f,a)!==!1;);else for(f in a)if(b(a[f],f,a)===!1)break}},k.eachRight=function(a,b,c){if(null!=a){var d=a.length,f=a.length,g="number"==typeof d;if(b=e(b,c),g)for(;--f>=0;)b(a[f],f,a);else for(f in a)b(a[f],f,a)}},k.each(["Arguments","Function","String","Number","Date","RegExp"],function(a){k["is"+a]=function(b){return f.call(b)=="[object "+a+"]"}}),k.isArguments(arguments)||(k.isArguments=function(a){return!(!a||!h.call(a,"callee"))}),"function"!=typeof/./&&(k.isFunction=function(a){return!(!a||"function"!=typeof a)}),k.isArray=Array.isArray||function(a){return"[object Array]"==f.call(a)},k.extend(k,{noop:function(){},inherit:function(a,b,c){return(arguments.length<3&&k.isPlainObject(b)||1==arguments.length)&&(c=b,b=a,a=void 0),a?(b.prototype=l(a.prototype),b.prototype.constructor=b,k.extend(b.prototype,c),b.prototype.__Class__=a,b.prototype._super=d):c&&(b.prototype=c),b},type:function(a){return a instanceof Array?"array":"string"==typeof a||a instanceof String?"string":"number"==typeof a||a instanceof Number?"number":a instanceof Date?"date":"[object RegExp]"===f.call(a)?"regexp":null===a?"null":void 0===a?"undefined":k.isFunction(a)?"function":k.isBoolean(a)?"boolean":"object"},is:function(a,b){return arguments.length>1&&k.isFunction(b)?b.prototype.isPrototypeOf(a):k.type(a)==b},has:function(a,b){return!(!a||!h.call(a,b))},hasValue:function(a){return!(null==a||k.isNumber(a)&&isNaN(a))},toString:function(a){var b="";return k.hasValue(a)&&(b=a.toString()),b},unwrap:function(a){return j.expressionsCreated&&j.isExpression(a)?a.value():k.unwrapObservable?k.unwrapObservable(a):a},$unwrap:function(a,b,c){return b=e(b,c),a&&a.jquery?(b&&a.each(function(){b(this)}),a=a[0]):b&&b(a),a},toArray:function(a){if(k.isArguments(a))return g.call(a);if(k.isElements(a)){for(var b=Array(a.length),c=-1,d=a.length;++c<d;)b[c]=a[c];return b}return k.isArray(a)?a:[a]},toUnit:function(a,b){var c=b;return b=b||"px",k.isNaN(parseFloat(a))?a:k.isString(a)&&k.isNaN(parseInt(a.charAt(a.length-1),10))?c?a.replace(/[^0-9]+$/,b):a:a+b},clone:function(a,b){if(null==a)return a;var c,d,e=k.type(a);if("array"==e)return a.slice(0);if("object"==e){c=a.constructor===Object?{}:new a.constructor;for(d in a)c[d]=b?k.clone(a[d],!0):a[d];return c}if("date"==e)return new Date(a.getFullYear(),a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds());if("string"==e)return a.toString();if("regexp"==e){var f="";return a.global&&(f+="g"),a.ignoreCase&&(f+="i"),a.multiline&&(f+="m"),c=new RegExp(a.source,f),c.lastIndex=a.lastIndex,c}return a},isElements:function(a){var b=!1;if(a&&("undefined"!=typeof HTMLCollection&&(b=a instanceof window.HTMLCollection),"undefined"==typeof NodeList||b||(b=a instanceof NodeList),!b&&k.isString(a.item)))try{a.item(0),b=!0}catch(c){}return b},isElement:function(a){return!(!a||1!==a.nodeType)},isBoolean:function(a){return a===!0||a===!1||"[object Boolean]"==f.call(a)},isObject:function(a){return a===Object(a)},isPlainObject:function(a){var b;if(!a||"object"!=typeof a||"[object Object]"!==f.call(a)||a.nodeType||a.window==a)return!1;try{if(a.constructor&&!h.call(a,"constructor")&&!h.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}if(i.ownPropertiesAreLast)for(b in a)return h.call(a,b);for(b in a);return void 0===b||h.call(a,b)},isFinite:function(a){return isFinite(a)&&!k.isNaN(parseFloat(a))},isNaN:function(a){return k.isNumber(a)&&a!=+a},isNull:function(a){return null===a},isUndefined:function(a){return void 0===a},nothing:{},access:function(a,b,c){var d,e=0;for(c=arguments.length>2?c:k.nothing,b=b.split("."),d=b[0];d;){if(null==a)return c;a=a[d],d=b[++e]}return a},swap:function(a,b,c){var d=a.length;return b>=0&&c>=0&&d>b&&d>c&&(a[b]=a[c]+(a[c]=a[b],0)),a},move:function(a,b,c){return b!=c&&(c>=b&&c++,a.splice(c,0,a[b]),b>c&&b++,a.splice(b,1)),a},bind:function(a,b){var c,d=function(){},e=g.call(arguments,2);return c=function(){if(!(this instanceof c))return a.apply(b,e.concat(g.call(arguments)));d.prototype=a.prototype;var f=new d,h=a.apply(f,e.concat(g.call(arguments)));return Object(h)===h?h:f}},equals:function(a,b,d){return a=k.unwrap(a),b=k.unwrap(b),c(a,b,[],[],d)}}),k.at=function(a){return{index:a,prototypeIndentification:"__blocks.at__"}},k.first=function(){return k.first},k.last=function(){return k.last};var l=Object.create||function(a){var b=function(){};return b.prototype=a,new b};for(var m in[i])break;i.ownPropertiesAreLast="0"!=m,function(){!function(){function a(a,b){if(null!=b){var c=a;a=function(a,d,e){return c.call(b,a,d,e)}}return a}function b(a){var b={};return k.each(a,function(a){b[a]=!0}),b}function c(){return!1}function d(){return!0}function e(a){this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.returnValue===!1?d:c,this.timeStamp=a.timeStamp||+new Date}function f(a,b,c){a.addEventListener&&"propertychange"!=b?a.addEventListener(b,function(a){c.call(this,e.fix(a))},!1):a.attachEvent&&a.attachEvent("on"+b,function(a){c.call(this,e.fix(a))})}function g(a,b){return a&&"string"==typeof a&&null!=b?(a=" "+a+" ",a.indexOf(" "+b+" ")):-1}function h(a){return String(a).replace($,"&amp;").replace(_,"&lt;")}function i(a){var b=document.createDocumentFragment(),c=document.createElement("div"),d=1,e="<table>",f="</table>",g="<tbody>",h="</tbody>",i="<tr>",j="</tr>";for(a=a.toString(),-1!=a.indexOf("<option")&&-1==a.indexOf("<select")?(a="<select>"+a+"</select>",d=2):-1==a.indexOf("<table")&&(a.match(/<(tbody|thead|tfoot)/)?(d=2,a=e+a+f):-1!=a.indexOf("<tr")?(d=3,a=e+g+a+h+f):a.match(/<(td|th)/)&&(d=4,a=e+g+i+a+j+h+f)),c.innerHTML="A<div>"+a+"</div>";d--;)c=c.lastChild;for(;c.firstChild;)b.appendChild(c.firstChild);return b}function j(a){return a?parseFloat(a[1]):void 0}function l(a,b,c){gb[b]?gb[b](a,c,function(b,c){f(a,b,c)}):f(a,b,c)}function m(a){return m.prototype.isPrototypeOf(this)?(this.__identity__=bb,this._tagName=a?a.toString().toLowerCase():null,this._attributes={},this._attributeExpressions=[],this._parent=null,this._children=[],this._isSelfClosing=!1,this._haveAttributes=!0,this._innerHTML=null,this._renderMode=m.RenderMode.All,this._haveStyle=!1,this._style={},this._states=null,this._state=null,void(k.isElement(a)&&(this._el=a))):new m(a)}function n(a,b){var c,d,e=' style="',f=!1;for(c in a)d=a[c],b&&ab.call(b.style,c)||(d||0===d)&&(f=!0,c=c.replace(/[A-Z]/g,o),e+=c,e+=":",e+=d,e+=";");if(b)for(c in b.style)d=b.style[c],(d||0===d)&&(f=!0,c=c.replace(/[A-Z]/g,o),e+=c,e+=":",e+=d,e+=";");return e+='"',f?e:""}function o(a){return"-"+a.toLowerCase()}function p(a,b,c){if(null!=c){c=k.isArray(c)?c:c.toString().split(" ");var d,e,f,h=0;if(m.Is(b))d=b._getAttr(W);else{if(b.classList)return void(mb?b.classList[a].apply(b.classList,c):k.each(c,function(c){b.classList[a](c)}));d=b.className}for(d=d||"";h<c.length;h++)e=c[h],f=g(d,e),"add"==a?0>f&&(""!==d&&(e=" "+e),d+=e):-1!=f&&(d=(d.substring(0,f)+" "+d.substring(f+e.length+1,d.length)).replace(V,""));m.Is(b)?b._state?b._state.attributes[W]=d:b._attributes[W]=d:b.className=d}}function q(a,b){var c=fb.data(a);if(c&&c.animating>0){for(var d,e=a.childNodes,f=0,h=0;b!=h;){if(!e[f])return Number.POSITIVE_INFINITY;d=e[f].className,f++,-1==g(d,"b-hide")&&h++}if(!e[f])return Number.POSITIVE_INFINITY;for(d=e[f].className;-1!=g(d,"b-hide");){if(f++,!e[f])return Number.POSITIVE_INFINITY;d=e[f].className}return f}return b}function r(a,b){var c=!1,d=fb.createIfNotExists(b),e=fb.createIfNotExists(b.parentNode),f=d.animateCallback,g="remove"==a?"hide":"add"==a?"show":a,h="remove"==a?function(){fb.clear(b,!0),b.parentNode&&b.parentNode.removeChild(b)}:"hide"==a?function(){b.style.display="none"}:k.noop,i=function(){d.animating-=1,e.animating-=1,d.animating||h()};if(1!=b.nodeType)return void h();if("show"==a&&(b.style.display=""),d.preprocess)return void h();if(f){c=!0,d.animating+=1,e.animating+=1;var j=k.context(b),l=j.$view||j.$root;f.call(l,b,i,g)}return c||s(g,b,h,i)}function s(a,b,c,d){function e(){p("remove",b,"b-"+a),p("remove",b,"b-"+a+"-end"),d(),b.removeEventListener("transitionend",e,!1),b.removeEventListener(f,e,!1)}if("undefined"==typeof window||void 0===window.ontransitionend)return void c();p("add",b,"b-"+a);var f,g=window.getComputedStyle(b),h="";void 0===window.onanimationend&&void 0!==window.onwebkitanimationend?(h="-webkit-",f="webkitAnimationEnd"):f="animationend";var i=parseFloat(g["transition-duration"])||0,j=parseFloat(g["transition-delay"])||0,k=parseFloat(g[h+"animation-duration"])||0,l=parseFloat(g[h+"animation-delay"])||0;return 0>=i&&0>=j&&0>=k&&0>=l?(p("remove",b,"b-"+a),void c()):(fb.createIfNotExists(b).animating+=1,fb.createIfNotExists(b.parentNode).animating+=1,setTimeout(function(){p("add",b,"b-"+a+"-end"),b.addEventListener("transitionend",e,!1),b.addEventListener(f,e,!1)},1),!0)}function t(a){return t.prototype.isPrototypeOf(this)?(this.__Class__(),void(8==a.nodeType?(this._commentText=a.nodeValue,this._el=a):this._commentText=a)):new t(a)}function u(a,b){for(var c,d,e,f,g,i,j,l,n,o=window.__blocksServerData__,p=[];a;){if(i=a.nodeType,1==i){d=a.tagName.toLowerCase(),c=new m(a),c._tagName=d,c._parent=b,b&&(c._each=b._each||b._childrenEach),c._haveAttributes=!1,f=a.attributes,e={};for(var q=0;q<f.length;q++)g=f[q],"style"!==g.nodeName&&(g.specified||eb.IE<8&&"value"==g.nodeName&&g.nodeValue)&&(e[g.nodeName.toLowerCase()]=eb.IE<11?g.nodeValue:g.value,c._haveAttributes=!0);c._attributes=e,c._createAttributeExpressions(o),a.style.cssText&&(c._haveStyle=!0,c._style=v(a.style.cssText)),w(c),"script"==d||"style"==d||"code"==d||c.hasClass("bl-skip")?c._innerHTML=a.innerHTML:c._children=u(a.childNodes[0],c),p.push(c)}else if(3==i)n=h(a.data),p.push(lb.Create(n,null,a)||n);else if(8==i)if(j=a.nodeValue,l=j.replace(V,""),0===l.indexOf("blocks"))c=new t(a),c._parent=b,c._attributes[db]=l.substring(6),n=u(a.nextSibling,c),c._children=n.elements,c._el._endElement=n.htmlElement,a=n.htmlElement||a,p.push(c);else{if(t.Is(b)&&0===l.indexOf("/blocks"))return{elements:p,htmlElement:a};if(t.Is(b))p.push("<!--"+j+"-->");else if(o){var r=parseInt(/[0-9]+/.exec(l),10);!k.isNaN(r)&&o[r]&&p.push(lb.Create(o[r]))}else 0!==l.indexOf("/blocks")&&p.push("<!--"+j+"-->")}a=a.nextSibling}return p}function v(a){for(var b,c,d,e=a.split(";"),f={},g=0;g<e.length;g++)c=e[g],c&&(b=c.indexOf(":"),-1!=b&&(d=[c.substring(0,b),c.substring(b+1)],f[d[0].toLowerCase().replace(V,"")]=d[1].replace(V,"")));return f}function w(a){var b,c=a._tagName;return void 0!==pb[c]?void(a._isSelfClosing=pb[c]):(b=document.createElement("div"),b.appendChild(document.createElement(c)),void(pb[c]=a._isSelfClosing=-1===b.innerHTML.indexOf("</")))}function x(a){return function(b){return 0===arguments.length?this[a]:(this[a]=b,this)}}function y(a,b){var c,d,e=0,f=0,g=0,h=0,i=!1,j=!1,k=0,l=[];a=a||"";for(var m=0;m<a.length;m++)e=a.charAt(m),i||j||("["==e?h++:"]"==e?h--:"{"==e?g++:"}"==e&&g--),0===g&&0===h&&("'"==e?i=!i:'"'==e&&(j=!j),i||j||("("==e?(0===f&&(d=a.substring(k,m).replace(V,""),k=m+1),f++):")"==e?(f--,0===f&&(c=a.substring(k,m).replace(V,""),c.length&&l.push(c),d&&(d=d.replace(/^("|')+|("|')+$/g,""),b(d,l)),l=[],d=void 0)):","==e&&1==f?(c=a.substring(k,m).replace(V,""),c.length&&l.push(c),k=m+1):"."==e&&0===f&&(k=m+1)))}function z(a){this._options=a||{},this._contextProperties={}}function A(a,b){var c=z.QueryCache[a]=[];return y(a,function(a,d){var e=k.queries[a],f={name:a,params:d,query:a+"("+d.join(",")+")"};e?"attr"==a||"val"==a?c.unshift(f):c.push(f):k.debug.queryNotExists(f,b)}),c}function B(a){this.observable=a,this.chunkLengths={},this.dispose()}function C(a){a._dependencyType&&(a._getDependency=k.bind(D,a),a.on("get",a._getDependency))}function D(){var a=this,b=a.__value__,c=1==a._dependencyType?b:b.get;U.off(a,"get",a._getDependency),a._getDependency=void 0,kb.startObserving(),c.call(a.__context__),k.each(kb.stopObserving(),function(b){var c=b._dependencies=b._dependencies||[],d=!1;k.each(c,function(b){return a===b?(d=!0,!1):void 0}),d||c.push(a)})}function E(a){var b=a.__context__;return 1==a._dependencyType?a.__value__.call(b):2==a._dependencyType?a.__value__.get.call(b):a.__value__}function F(a,b,c){var d=a.errorMessage,e=a.errorMessages;d(c?"":b.errorMessage||e()[0]||""),a.valid(c)}function G(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function H(a){return H.Is(a)?a:H.Is(this)?(this._routeString=a,this._wildcard={},this._optional={},this._validate={},void(this._transform={})):new H(a)}function I(){this._currentRoute={},this._routes={}}function J(a){this.options=k.extend({},J.Defaults,a),this.execute()}function K(a){if(window){var b=window.jQuery||window.$;b&&b.ajax?b.ajax(a):J.Execute(a)}}function L(a){a=a||{};var b=a.data,c=a.baseUrl;a=this.options=(a.data=void 0)||k.extend(!0,{},this.options,a),c&&(a.read.url=c+a.read.url,a.create.url=c+a.create.url,a.destroy.url=c+a.destroy.url,a.update.url=c+a.update.url),this.data=k.observable(k.unwrap(b)||[]).extend().on("add remove",k.bind(this._onArrayChange,this)),this.hasChanges=k.observable(!1),this._aggregates=null,this._changes=[],this._changesMeta={},this._subscribeToEvents()}function M(a){this._options=a||{}}function N(a,b,c,d){var e=this;this._application=a,this._collection=d,this._initialDataItem=k.clone(c,!0),k.each(N.prototype,function(a,b){k.isFunction(a)&&0!==b.indexOf("_")&&(e[b]=k.bind(a,e))}),O(b,this),this.valid=k.observable(!0),this.isLoading=k.observable(!1),this.validationErrors=k.observable([]),this._isNew=!1,this._dataItem=c||{},this._properties=M.Inflate(this),this.options.baseUrl||(this.options.baseUrl=a.options.baseUrl),this.options.mode=L.ObjectMode,this._dataSource=new L(this.options),this._dataSource.on("change",this._onDataSourceChange,this),this._dataSource.requestStart(function(){e.isLoading(!0)}),this._dataSource.requestEnd(function(){e.isLoading(!1)}),this._dataSource.on("sync",this._onDataSourceSync),this.hasChanges=this._dataSource.hasChanges,this._ensurePropertiesCreated(c),this.init()}function O(a,b){var c,d;if(a.__used__)for(c in a)d=a[c],M.Is(d)||(b[c]=k.isObservable(d)?d.clone(!0):k.isFunction(d)?k.bind(d,b):N.prototype.isPrototypeOf(d)?d.clone(!0):k.isObject(d)&&!k.isPlainObject(d)?k.clone(d,!0):k.clone(d,!0));else for(c in a)d=a[c],k.isObservable(d)?d.__context__=b:k.isFunction(d)&&(b[c]=k.bind(d,b),b[c].unbound=d);a.__used__=!0}function P(a){this._options=k.extend({root:"/"},a),this._tryFixOrigin(),this._initial=!0,this._location=window.location,this._history=window.history,this._root=("/"+this._options.root+"/").replace(Eb,"/"),this._interval=50,this._fragment=this._getFragment(),this._wants=this._options.history===!0?Ib:this._options.history,this._use=this._wants==Jb&&this._history&&this._history.pushState?Jb:Ib,this._hostRegEx=new RegExp(G(this._location.host))}function Q(a,b,c,d){return R(a,b,c,d)}function R(a,b,c,d){var e,f=k.observable([]).extend(),g=M.Inflate(b);for(e in g)f[e]=g[e];return f._baseUpdate=f.update,k.each(k.observable.fn.collection,function(a,b){k.isFunction(a)&&0!==b.indexOf("_")&&(f[b]=k.bind(f[b],f))}),k.extend(f,k.observable.fn.collection,b),O(b,f),f._Model=a,f._prototype=b,c&&(f._application=c,f._view=k.__viewInInitialize__,b.options.baseUrl||(b.options.baseUrl=c.options.baseUrl)),f._dataSource=new L(b.options),f._dataSource.on("change",f._onDataSourceChange,f),f.hasChanges=f._dataSource.hasChanges,a&&(f.on("adding",f._onAdding,f),f.on("remove add",f._onChange,f)),k.isArray(d)&&f.reset(d),b.init&&b.init.call(f),f}function S(a,b,c){var d=this,e=this.options,f=this._views=[],g=k.has(e,"route");O(c,this),this._application=a,this._parentView=b||null,this._initCalled=!1,this._html=void 0,this.loading=k.observable(!1),this.isActive=k.observable(!g),this.isActive.on("changing",function(a,b){k.each(f,function(a){g||a.isActive(b)}),d._tryInitialize(b)}),(e.preload||this.isActive())&&this._load()}function T(a){this._router=new I(this),this._modelPrototypes={},this._collectionPrototypes={},this._viewPrototypes={},this._views={},this._currentRoutedView=void 0,this._started=!1,this.options=k.extend({},this.options,a),this._serverData=null,this._setDefaults(),this._prepare()}var U=function(){function a(a){return function(b,c){return arguments.length>1?U.on(this,a,b,c):U.on(this,a,b),this}}var b={on:function(a,b,c){return arguments.length>2?U.on(this,a,b,c):U.on(this,a,b),this},once:function(a,b,c){U.once(this,a,b,c)},off:function(a,b){U.off(this,a,b)},trigger:function(a){U.trigger(this,a,k.toArray(arguments).slice(1,100))}};return b._trigger=b.trigger,{register:function(c,d){d=k.isArray(d)?d:[d];for(var e=0;e<d.length;e++){var f=d[e];c[f]=b[f]?b[f]:a(f)}},on:function(a,b,c,d){b=k.toArray(b).join(" ").split(" ");var e,f=0,g=b.length;if(c)for(a._events||(a._events={});g>f;f++)e=b[f],a._events[e]||(a._events[e]=[]),a._events[e].push({callback:c,thisArg:d})},once:function(a,b,c,d){U.on(a,b,c,d),U.on(a,b,function(){U.off(a,b,c)})},off:function(a,b,c){k.isFunction(b)&&(c=b,b=void 0),void 0!==b||void 0!==c?k.each(a._events,function(d,e){void 0!==b&&void 0===c?a._events[b]=[]:k.each(d,function(b,d){return b.callback==c?(a._events[e].splice(d,1),!1):void 0})}):a._events=void 0},trigger:function(a,b){var c,d,e,f=!0;return a&&a._events&&(c=a._events[b],c&&c.length>0&&(e=Array.prototype.slice.call(arguments,2),k.each(c,function(b){b&&(d=a,void 0!==b.thisArg&&(d=b.thisArg),b.callback.apply(d,e)===!1&&(f=!1))}))),f},has:function(a,b){return!!k.access(a,"_events."+b+".length")}}}();!function(){function b(){if("complete"===document.readyState)setTimeout(d);else if(document.addEventListener)document.addEventListener("DOMContentLoaded",c,!1),window.addEventListener("load",c,!1);else{document.attachEvent("onreadystatechange",c),window.attachEvent("onload",c);var a=!1;try{a=null==window.frameElement&&document.documentElement}catch(b){}a&&a.doScroll&&!function e(){if(!k.isDomReady){try{a.doScroll("left")}catch(b){return setTimeout(e,50)}d()}}()}}function c(){(document.addEventListener||"load"==event.type||"complete"==document.readyState)&&d()}function d(){k.isDomReady||(k.isDomReady=!0,U.trigger(k.core,"domReady"),U.off(k.core,"domReady"))}k.isDomReady=!1,k.domReady=function(c,d){"undefined"==typeof document||"undefined"==typeof window||window.__mock__&&document.__mock__||(c=a(c,d),k.isDomReady||"complete"==document.readyState||window.jQuery&&window.jQuery.isReady?(k.isDomReady=!0,c()):(U.on(k.core,"domReady",c),b()))}}();var V=(Array.prototype.slice,/^\s+|\s+$/gm),W="class",X=k.queries={},Y=/^(?:mouse|pointer|contextmenu)|click/,Z=/^key/;e.PropertiesToCopy={all:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),mouse:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),keyboard:"char charCode key keyCode".split(" ")},e.CopyProperties=function(a,b,c){k.each(e.PropertiesToCopy[c],function(c){b[c]=a[c]})},e.prototype={preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=d,a.preventDefault?a.preventDefault():a.returnValue=!1},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=d,a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=d,a.stopImmediatePropagation&&a.stopImmediatePropagation(),this.stopPropagation()}},e.fix=function(a){var b=a.type,c=new e(a);return e.CopyProperties(a,c,"all"),c.target||(c.target=a.srcElement||document),3===c.target.nodeType&&(c.target=c.target.parentNode),c.metaKey=!!c.metaKey,Y.test(b)?e.fixMouse(a,c):Z.test(b)&&null==c.which&&(e.CopyProperties(a,c,"keyboard"),c.which=null!=a.charCode?a.charCode:a.keyCode),c},e.fixMouse=function(a,b){var c,d,f,g=a.button,h=a.fromElement;e.CopyProperties(a,b,"mouse"),null==b.pageX&&null!=a.clientX&&(d=b.target.ownerDocument||document,f=d.documentElement,c=d.body,b.pageX=a.clientX+(f&&f.scrollLeft||c&&c.scrollLeft||0)-(f&&f.clientLeft||c&&c.clientLeft||0),b.pageY=a.clientY+(f&&f.scrollTop||c&&c.scrollTop||0)-(f&&f.clientTop||c&&c.clientTop||0)),!b.relatedTarget&&h&&(b.relatedTarget=h===b.target?a.toElement:h),b.which||void 0===g||(b.which=1&g?1:2&g?3:4&g?2:0)};var $=/&/g,_=/</g,ab=Object.prototype.hasOwnProperty,bb="__blocks.VirtualElement__",cb="data-id",db="data-query",eb={};"undefined"!=typeof document&&k.extend(eb,{IE:document&&function(){for(var a=3,b=document.createElement("div"),c=b.getElementsByTagName("i");b.innerHTML="<!--[if gt IE "+ ++a+"]><i></i><![endif]-->",c[0];);return a>4?a:void 0}(),Opera:window&&window.navigator&&window.opera&&window.opera.version&&parseInt(window.opera.version(),10)||void 0,Safari:window&&window.navigator&&j(window.navigator.userAgent.match(/^(?:(?!chrome).)*version\/([^ ]*) safari/i)),Firefox:window&&window.navigator&&j(window.navigator.userAgent.match(/Firefox\/([^ ]*)/))});var fb=function(){function a(a){var b=a?m.Is(a)?a._state?a._state.attributes[cb]:a._attributes[cb]:1==a.nodeType?a.getAttribute(cb):8==a.nodeType?/\s+(\d+):[^\/]/.exec(a.nodeValue):null:null;return k.isArray(b)?b[1]:b}function b(a,b){m.Is(a)?a.attr(cb,b):1==a.nodeType&&a.setAttribute(cb,b)}var c={},d=1;return{id:function(b){return a(b)},reset:function(){c={},d=1},collectGarbage:function(){k.each(c,function(a){a&&a.dom&&!document.body.contains(a.dom)&&fb.clear(a.id,!0)})},createIfNotExists:function(e){var f,g,h=e&&e.__identity__==bb;return f=h?c[e._getAttr(cb)]:c[e&&a(e)],f||(g=d++,e&&(h&&e._each?(e._haveAttributes=!0,e._state?e._state.attributes[cb]=g:e._attributes[cb]=g):b(e,g)),f=c[g]=e?{id:g,virtual:h?e:null,animating:0,observables:{},preprocess:h}:{id:g}),f},byId:function(a){return c[a]},data:function(b,d,e){var f=c[a(b)||b];if(f)return 1==arguments.length?f:(arguments.length>2&&(f[d]=e),f[d])},clear:function(b,d){var e=a(b)||b,f=c[e];!f||f.haveData&&!d||(k.each(f.observables,function(a){for(var b=0;b<a._elements.length;b++)a._elements[b].elementId==c.id&&(a._elements.splice(b,1),b--)}),c[e]=void 0,m.Is(b)?b.attr(cb,null):1==b.nodeType&&b.removeAttribute(cb))}}}(),gb={input:function(a,b,c){function d(a){clearTimeout(f),b(a)}function e(){f||(f=setTimeout(d,4))}var f;eb.IE<10?(c("propertychange",function(a){"value"===a.originalEvent.propertyName&&d(a)}),8==eb.IE&&(c("keyup",d),c("keydown",d)),eb.IE>=8&&(hb(a,d),c("dragend",e))):(c("input",d),eb.Safari<7&&"textarea"==a.tagName.toLowerCase()?(c("keydown",e),c("paste",e),c("cut",e)):eb.Opera<11?c("keydown",e):eb.Firefox<4&&(c("DOMAutoComplete",d),c("dragdrop",d),c("drop",d)))}},hb=function(){function a(a){var b=this.activeElement,c=b&&fb.data(b,"selectionchange");c&&c(a)}var b=!1;return function(c,d){b||(f(c.ownerDocument,"selectionchange",a),b=!0),fb.createIfNotExists(c).selectionChange=d}}(),ib=k.dom={valueTagNames:{input:!0,textarea:!0,select:!0},valueTypes:{file:!0,hidden:!0,password:!0,text:!0,color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,time:!0,url:!0,week:!0},props:{"for":!0,"class":!0,value:!0,checked:!0,tabindex:!0,className:!0,htmlFor:!0},propFix:{"for":"htmlFor","class":"className",tabindex:"tabIndex"},attrFix:{className:"class",htmlFor:"for"},addClass:function(a,b){a&&p("add",a,b)},removeClass:function(a,b){a&&p("remove",a,b)},html:function(a,b){if(a)if(b=b.toString(),8==a.nodeType)ib.comment.html(a,b);else if(eb.IE<10){for(;a.firstChild;)a.removeChild(this._element.firstChild);a.appendChild(i(b))}else a.innerHTML=b},css:function(a,b,c){a&&b&&("display"==b?ob.setVisibility(a,"none"==c?!1:!0):a.style[b]=c)},on:function(a,b,c){a&&l(a,b,c)},off:function(){},removeAttr:function(a,b){a&&b&&ib.attr(a,b,null)},attr:function(a,c,d){var e=ib.props[c];return c=ib.propFix[c.toLowerCase()]||c,k.core.skipExecution&&k.core.skipExecution.element===a&&k.core.skipExecution.attributeName==c||!a?void 0:8==a.nodeType?void ib.comment.attr(a,c,d):("checked"==c&&(d="checked"!=d&&"string"==typeof d&&"radio"==a.getAttribute("type")&&d!=a.value&&null!=a.defaultValue&&""!==a.defaultValue?!1:!!d),1===arguments.length?e?a[c]:a.getAttribute(c):void(null!=d?"value"==c&&"select"==a.tagName.toLowerCase()?(d=b(k.toArray(d)),k.each(a.children,function(a){a.selected=!!d[a.value]})):e?a[c]=d:a.setAttribute(c,d):e?"value"==c&&"select"==a.tagName.toLowerCase()?a.selectedIndex=-1:a[c]&&(a[c]=""):a.removeAttribute(c)))},comment:{html:function(a,b){for(var c,d=a,e=d.parentNode,f=d.nextSibling,g=0;f&&(8!=f.nodeType||-1==f.nodeValue.indexOf("/blocks"));)g++,c=f.nextSibling,e.removeChild(f),f=c;return e.insertBefore(i(b),d.nextSibling),g},attr:function(a,b,c){if(a&&b==cb&&c){var d=a,e=a._endElement;return d.nodeValue=" "+c+":"+d.nodeValue.replace(V,"")+" ",e.nodeValue=" "+c+":"+e.nodeValue.replace(V,"")+" ",this}return this}}},jb={},kb=function(){var a=[];return{startObserving:function(){a.push([])},stopObserving:function(){return a.pop()},currentObservables:function(){return a[a.length-1]},registerObservable:function(b){var c=a[a.length-1],d=!1;c&&(k.each(c,function(a){return a===b?(d=!0,!1):void 0}),d||c.push(b))}}}(),lb={Html:0,ValueOnly:2,Create:function(a,b,c){for(var d,e,f,g=-1,h=0,i=[];a.length>++g;)d=a.charAt(g),"{"==d&&"{"==a.charAt(g+1)?e=g+2:"}"==d&&"}"==a.charAt(g+1)&&(e&&(f=a.substring(e,g),b||(f=f.replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">")),d=a.substring(h,e-2),d&&i.push(d),i.push({expression:f,attributeName:b}),h=g+2),e=0);return d=a.substring(h),d&&i.push(d),i.text=a,i.attributeName=b,i.element=c,i.isExpression=!0,f?i:null},GetValue:function(a,b,c,d){var e,f="",g=c.length,h=-1;if(!a)return c.text;if(1==g)f=lb.Execute(a,b,c[0],c,d);else for(;++h<g;)e=c[h],f+="string"==typeof e?e:lb.Execute(a,b,e,c,d);return c.lastResult=f,f},Execute:function(a,b,c,d,e){var f,g,i,j,l,m,n=c.expression,o=c.attributeName;m=jb[n]=jb[n]||new Function("c","with(c){with($this){ return "+n+"}}"),kb.startObserving();try{l=m(a)}catch(p){k.debug.expressionFail(n,d.element)}return l=m(a),f=k.isObservable(l),j=f?l():l,j=null==j?"":j.toString(),j=h(j),i=kb.stopObserving(),e!=lb.ValueOnly&&(f||i.length)&&(o||(b=fb.createIfNotExists()),b&&(b.haveData=!0,g={length:j.length,attr:o,context:a,elementId:b.id,expression:n,entire:d},k.each(i,function(a){a._expressionKeys[b.id]||(a._expressionKeys[b.id]=!0,a._expressions.push(g))})),o||(j="<!-- "+b.id+":blocks -->"+j)),j}};k.VirtualElement=k.inherit(m,{tagName:function(a){return a?(this._tagName=a,this):this._tagName},html:function(a){return arguments.length>0?(a=null==a?"":a,this._state?this._state.html!==a&&(this._state.html=a,ib.html(this._el,a)):(this._innerHTML=a,ib.html(this._el,a)),this._children=[],this):this._innerHTML||""},text:function(a){return arguments.length>0?(null!=a&&(a=h(a),this.html(a)),this):this.html()},parent:function(){return this._parent},children:function(a){return"number"==typeof a?this._children[a]:this._children},attr:function(a,c){var d,e=this;if("string"==typeof a){var f=this._tagName,g=this._attributes.type,h=c,i=fb.data(this),j=this._getAttr("value");if(a=k.unwrapObservable(a),a=ib.attrFix[a]||a,c=k.unwrapObservable(c),k.isObservable(h)&&"value"==a&&ib.valueTagNames[f]&&(!g||ib.valueTypes[g])?(i.subscribe="select"==f?"change":"input",i.valueObservable=h):!k.isObservable(h)||"checked"!=a||"checkbox"!=g&&"radio"!=g||(i.subscribe="click",i.valueObservable=h),1==arguments.length)return d=this._getAttr(a),void 0===d?null:d;"checked"!=a||null==c||this._fake?"disabled"==a&&(c=c?"disabled":null):c="radio"==this._attributes.type&&"string"==typeof c&&j!=c&&null!=j?null:c?"checked":null,"textarea"!=f||"value"!=a||this._el?"value"==a&&"select"==f?(this._values=b(k.toArray(c)),ib.attr(this._el,a,c)):(this._haveAttributes=!0,this._state?this._state.attributes[a]!==c&&(this._state.attributes[a]=c,ib.attr(this._el,a,c)):(this._attributes[a]=c,ib.attr(this._el,a,c))):this.html(c)}else k.isPlainObject(a)&&k.each(a,function(a,b){e.attr(b,a)});return this},removeAttr:function(a){return this._attributes[a]=null,ib.removeAttr(this._el,a),this},css:function(a,b){var c=this;if("string"==typeof a){if(a=k.unwrap(a),b=k.unwrap(b),!a)return;if(a=a.toString().replace(/-\w/g,function(a){return a.charAt(1).toUpperCase()}),1===arguments.length)return b=this._getCss(a),void 0===b?null:b;"display"==a&&(b="none"==b||!b&&""!==b?"none":""),this._haveStyle=!0,m.CssNumbers[a]||(b=k.toUnit(b)),this._state?this._state.style[a]!==b&&(this._state.style[a]=b,ib.css(this._el,a,b)):(this._style[a]=b,ib.css(this._el,a,b))}else k.isPlainObject(a)&&k.each(a,function(a,b){c.css(b,a)});return this},addChild:function(a,b){var c,d=this._template||this._children;return a&&(a._parent=this,this._childrenEach||this._each?a._each=!0:this._el&&(c=i(a.render(k.domQuery(this))),a._el=c.childNodes[0],"number"==typeof b?this._el.insertBefore(c,this._el.childNodes[b]):this._el.appendChild(c)),"number"==typeof b?d.splice(b,0,a):d.push(a)),this},addClass:function(a){return p("add",this,a),ib.addClass(this._el,a),this},removeClass:function(a){return p("remove",this,a),ib.removeClass(this._el,a),this},toggleClass:function(a,b){b===!1?this.removeClass(a):this.addClass(a)},hasClass:function(a){return-1!=g(this._attributes[W],a)},renderBeginTag:function(){var a;return a="<"+this._tagName,this._haveAttributes&&(a+=this._renderAttributes()),this._haveStyle&&(a+=n(this._style,this._state)),a+=this._isSelfClosing?" />":">"},renderEndTag:function(){return this._isSelfClosing?"":"</"+this._tagName+">"},render:function(a,b){var c="",d="",e=this._el;return void 0!==b&&(this._state={attributes:{},style:{},html:null,expressions:{}},this._states||(this._states={}),this._states[b]=this._state),this._el=void 0,this._execute(a),this._el=e,this._renderMode!=m.RenderMode.None&&(this._renderMode!=m.RenderMode.ElementOnly&&(d=this._state&&null!==this._state.html?this._state.html:null!=this._innerHTML?this._innerHTML:this.renderChildren(a,b)),c+=this.renderBeginTag(),c+=d,c+=this.renderEndTag()),this._state=null,c
},renderChildren:function(a,b){for(var c,d,e="",f=this._template||this._children,g=f.length,h=-1;++h<g;)c=f[h],"string"==typeof c?e+=c:m.Is(c)?(c._each=c._each||this._each,e+=c.render(a,b)):a?(d=lb.GetValue(a._context,null,c),this._state&&(this._state.expressions[h]=d),e+=d):e+=!this._each&&c.lastResult?c.lastResult:lb.GetValue(null,null,c);return e},sync:function(a,b,c){b&&(this._state=this._states[b],this._el=c,this._each=!1,this._sync=!0),this._execute(a),this.renderBeginTag(),this._innerHTML||this._childrenEach||this._renderMode==m.RenderMode.None||this.syncChildren(a,b),this.renderEndTag(),b&&(this._state=null,this._el=void 0,this._each=!0,this._sync=!1)},syncChildren:function(a,b,c){for(var d,e,f,g=this._template||this._children,h=g.length,j=this._state,k=8==this._el.nodeType?this._el.nextSibling:this._el.childNodes[c||0],l=-1;++l<h;)f=g[l],f.isExpression?a&&(e=lb.GetValue(a._context,null,f,j?lb.ValueOnly:lb.Html),(!j||j&&j.expressions[l]!==e)&&(j?(j.expressions[l]=e,k?(8==k.nodeType&&(k=k.nextSibling),k.nodeValue=e,k=k.nextSibling):this._el.textContent=e):(this._el.insertBefore(i(e),k),d=k,k=k.nextSibling,this._el.removeChild(d)))):"string"!=typeof f&&f._renderMode!=m.RenderMode.None?(f._each=f._each||this._each,f.sync(a,b,k),k=k.nextSibling):k=k.nextSibling},updateChildren:function(a,b,c,d){for(var e,f=this._template,g=f[0],h=1===f.length&&m.Is(g),i=d.childNodes,j=c.getSyncIndex(),k=c._context.childs,l=this._length(),n=this._headers?this._headers.length:0,o=-1;++o<b;)c._context=e=k[o],e.$this=a[o],e.$parent=e.$parentContext.$this,h?g.sync(c,j+o,i[o+n]):this.syncChildren(c,j+o,o*l+n);c.popContext()},_length:function(){for(var a=this._template,b=-1,c=0;++b<a.length;)a[b]._renderMode!==m.RenderMode.None&&(c+=1);return c},_getAttr:function(a){var b=this._state;return b&&void 0!==b.attributes[a]?b.attributes[a]:this._attributes[a]},_getCss:function(a){var b=this._state;return b&&void 0!==b.style[a]?b.style[a]:this._style[a]},_execute:function(a){if(a&&(this._each&&(this._el=void 0),this._renderMode!=m.RenderMode.None)){var b,c=this._attributes[cb];(!c||a._serverData)&&(fb.createIfNotExists(this),a.applyContextToElement(this),c=this._attributes[cb],b=fb.byId(c)),this._attributeExpressions.length&&this._executeAttributeExpressions(a._context),a.executeQuery(this,this._attributes[db]),b&&!b.haveData&&fb.clear(this)}},_renderAttributes:function(){var a,b,c=this._attributes,d=this._state,e="";"option"==this._tagName&&this._parent._values&&(d?d.attributes.selected=this._parent._values[d.attributes.value]?"selected":null:c.selected=this._parent._values[c.value]?"selected":null);for(a in c)b=c[a],d&&ab.call(d.attributes,a)||(""===b?e+=" "+a:null!=b&&(e+=" "+a+'="'+b+'"'));if(d)for(a in d.attributes)b=d.attributes[a],""===b?e+=" "+a:null!=b&&(e+=" "+a+'="'+b+'"');return e},_createAttributeExpressions:function(a){var b,c=this._attributeExpressions,d=this._attributes[cb],e=this._each;k.each(this._attributes,function(f,g){b=!e&&a&&a[d+g]?lb.Create(a[d+g],g):lb.Create(f,g),b&&c.push(b)})},_executeAttributeExpressions:function(a){for(var b,c,d,e=this._el?!1:!0,f=this._state&&this._state.attributes,g=fb.byId(f?f[cb]:this._attributes[cb]),h=this._attributeExpressions,i=0;i<h.length;i++)c=h[i],d=lb.GetValue(a,g,c),b=c.attributeName,(f&&f[b]!==d||!f)&&(e?this._state?this._state.attributes[b]=d:this._attributes[b]=d:ib.attr(this._el,b,d))}}),m.Is=function(a){return a&&a.__identity__==bb},m.RenderMode={All:0,ElementOnly:2,None:4},m.CssNumbers={columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0};var mb=!0;if("undefined"!=typeof document){var nb=document.createElement("div");nb.classList&&(nb.classList.add("a","b"),mb="a b"==nb.className)}var ob={insert:function(a,b,c){b=q(a,b);var d,e,f=a.childNodes[b];k.each(c,function(b){if(d=11==b.nodeType?b.childNodes.length:0,e=b.childNodes?b.childNodes[0]:void 0,f?a.insertBefore(b,f):a.appendChild(b),d)for(;d;)r("add",e),e=e.nextSibling,d--;else r("add",b)})},remove:function(a,b,c){var d,e=0;for(b=q(a,b);c>e;e++)d=a.childNodes[b],d&&r("remove",d)&&b++},setVisibility:function(a,b){b?ob.show(a):ob.hide(a)},show:function(a){r("show",a)},hide:function(a){r("hide",a)}};k.VirtualComment=k.inherit(m,t,{renderBeginTag:function(){var a=this._getAttr(cb),b="<!-- ";return a&&(b+=a+":"),b+=this._commentText.replace(V,"")+" -->"},renderEndTag:function(){var a=this._getAttr(cb),b="<!-- ";return a&&(b+=a+":"),b+="/blocks -->"},_executeAttributeExpressions:k.noop}),t.Is=function(a){return t.prototype.isPrototypeOf(a)};var pb={};z.QueryCache={},z.prototype={options:function(){return this._options},dataIndex:x("_dataIndex"),context:x("_context"),popContext:function(){this._context&&(this._context=this._context.$parentContext)},applyContextToElement:function(a){var b=fb.createIfNotExists(a);b.domQuery=this,b.context=this._context,(this._hasChanged||a._each&&!a._parent._each)&&(a._parent&&!a._each&&(b=fb.createIfNotExists(a._parent),b.childrenContext=this._context),this._hasChanged=!1,b.haveData=!0)},pushContext:function(a){var b,c=this._context,d=c?c.$parents.slice(0):[];return this._hasChanged=!0,c&&d.unshift(c.$this),b={$this:a,$root:c?c.$root:a,$parent:c?c.$this:null,$parents:c?d:[],$index:this._dataIndex||null,$parentContext:c||null},b.$context=b,this._context=b,this.applyDefinedContextProperties(),b},getSyncIndex:function(){for(var a=this._context,b="";a&&a.$index;)b=a.$index.__value__+"_"+b,a=a.$parentContext;return b},contextBubble:function(a,b){var c=this._context;this._context=a,b(),this._context=c},addProperty:function(a,b){this._contextProperties[a]=b,this.applyDefinedContextProperties()},removeProperty:function(a){delete this._contextProperties[a]},applyDefinedContextProperties:function(){var a,b=this._context,c=this._contextProperties;for(a in c)b[a]=c[a]},executeElementQuery:function(a){var b=m.Is(a)?a._attributes[db]:1==a.nodeType?a.getAttribute(db):a.nodeValue.substring(a.nodeValue.indexOf("blocks")+6).replace(V,"");b&&this.executeQuery(a,b)},executeQuery:function(a,b){var c=z.QueryCache[b]||A(b,a);this.executeMethods(a,c)},executeMethods:function(a,b){for(var c,d,e,f,g,h,i,j=fb.data(a),l=0,n=0;n<b.length;n++)if(h=this._context,c=k.queries[b[n].name],f=b[n].params,d=c.passDomQuery?[this]:[],!m.Is(a)||c.call||c.preprocess||!c.update&&!c.ready){kb.startObserving();for(var o=0;o<f.length;o++){g=f[o],i=jb[g]=jb[g]||new Function("c","with(c){with($this){ return "+g+"}}"),e={};try{e.rawValue=i(h)}catch(p){k.debug.queryParameterFail(b[n],g,a)}if(e.rawValue=i(h),e.value=k.unwrapObservable(e.rawValue),c.passDetailValues?(e.isObservable=k.isObservable(e.rawValue),e.containsObservable=kb.currentObservables().length>l,l=kb.currentObservables().length,d.push(e)):d.push(c.passRawValues?e.rawValue:e.value),c===k.queries["if"]||c===k.queries.ifnot){if(!e.value&&c===k.queries["if"]||e.value&&c===k.queries.ifnot){if(!f[2])break;this.executeQuery(a,f[2]);break}this.executeQuery(a,f[1]);break}}var q=d;if(c.passDomQuery&&(q=k.clone(d).slice(1)),k.debug.checkQuery(b[n].name,q,b[n],a),m.Is(a)){if(t.Is(a)&&!c.supportsComments)continue;if(c.call)c.call===!0?a[b[n].name].apply(a,d):(d.unshift(c.prefix||b[n].name),a[c.call].apply(a,d));else if(c.preprocess&&c.preprocess.apply(a,d)===!1){this.subscribeObservables(b[n],j,h);break}}else if(c.call){var r=fb.data(a).virtual;r._each&&(r=m("div"),r._el=a,r._fake=!0),c.call===!0?r[b[n].name].apply(r,d):(d.unshift(c.prefix||b[n].name),r[c.call].apply(r,d))}else j&&j.preprocess&&c.ready?c.ready.apply(a,d):c.update&&c.update.apply(a,d);this.subscribeObservables(b[n],j,h)}else j.haveData=!0,j.execute||(j.execute=[],j.executeHash={}),j.executeHash[b[n].query]||(j.execute.push(b[n]),j.executeHash[b[n].query]=!0)},subscribeObservables:function(a,b,c){var d=kb.stopObserving();b&&(b.haveData=!0,k.each(d,function(d){b.observables[d.__id__+a.query]||(b.observables[d.__id__+a.query]=d,d._elements.push({elementId:b.id,cache:[a],context:c}))}))},createElementObservableDependencies:function(a){for(var b,c,d,e=0;e<a.length;e++)if(b=a[e],d=(b.tagName||"").toLowerCase(),1===b.nodeType||8==b.nodeType){if(c=fb.data(b)){if(this._context=c.context||this._context,c.dom=b,c.execute&&this.executeMethods(b,c.execute),c.subscribe){var f=c.updateOn||c.subscribe;l(b,f,qb[f])}c.preprocess=!1,this._context=c.childrenContext||this._context}"script"!=d&&"code"!=d&&-1==(" "+b.className+" ").indexOf("bl-skip")&&this.createElementObservableDependencies(b.childNodes)}this._context=null},createFragment:function(a){var b=i(a);return this.createElementObservableDependencies(b.childNodes),b},cloneContext:function(a){var b=k.clone(a);return b.$context=b,b}};var qb={change:function(a){var b=a.target||a.srcElement;qb.getSetValue(b,fb.data(b).valueObservable)},click:function(a){qb.change(a)},input:function(a){var b=a.target||a.srcElement;qb.getSetValue(b,fb.data(b).valueObservable)},keydown:function(a){var b=a.target||a.srcElement,c=b.value,d=fb.data(b);d&&setTimeout(function(){c!=b.value&&qb.getSetValue(b,fb.data(b).valueObservable)})},getSetValue:function(a,b){var c=a.tagName.toLowerCase(),d=a.getAttribute("type");if("checkbox"==d)b(a.checked);else if("select"==c&&a.getAttribute("multiple")){var e=[],f=a.selectedOptions;f?k.each(f,function(a){e.push(a.getAttribute("value"))}):k.each(a.options,function(a){a.selected&&e.push(a.getAttribute("value"))}),b(e)}else k.core.skipExecution={element:a,attributeName:"value"},b(a.value),k.core.skipExecution=void 0}};k.extend(X,{"if":{},ifnot:{},template:{passDomQuery:!0,passRawValues:!0,preprocess:function(a,b,c){var d,e=a._serverData;b=k.$unwrap(b),k.isElement(b)?d=b.innerHTML:(d=document.getElementById(b),d=d?d.innerHTML:b),d&&(c&&k.queries["with"].preprocess.call(this,a,c,"$template"),e&&e.templates&&e.templates[fb.id(this)]||(this.html(d),!this._each&&this._el&&(this._children=u(this._el.childNodes[0],this),this._innerHTML=null)))}},define:{passDomQuery:!0,preprocess:function(a,b,c){if(this._renderMode!=m.RenderMode.None){var d=a.context(),e=a.cloneContext(d),f=this.renderEndTag;a.context(e),a.addProperty(b,c),this.renderEndTag=function(){return a.removeProperty(b),a.context(d),f.call(this)}}}},"with":{passDomQuery:!0,passRawValues:!0,preprocess:function(a,b,c){if(this._renderMode!=m.RenderMode.None){var d=this.renderEndTag;c&&a.addProperty(c,b),a.pushContext(b),this.renderEndTag=function(){return c&&a.removeProperty(c),a.popContext(),d.call(this)}}}},each:{passDomQuery:!0,passRawValues:!0,supportsComments:!0,_getStaticHtml:function(a,b){var c,d,e,f=b._children,g=b._headers,h=b._footers,i=-1,j="",k="";if(g)for(c=Math.max(g.length,h.length);++i<c;)g[i]&&(j+=g[i].render(a)),h[i]&&(k+=h[i].render(a));else for(g=b._headers=[],h=b._footers=[];++i<f.length;)e=f[i],e.isExpression||("string"!=typeof e?(e._each=!0,d=e._attributes["data-role"],"header"==d?(j+=e.render(a),g.push(e),f.splice(i--,1)):"footer"==d&&(k+=e.render(a),h.push(e),f.splice(i--,1))):""===e.replace(V,"").replace(/(\r\n|\n|\r)/gm,"")&&f.splice(i--,1));return{header:j,headersCount:g.length,footer:k,footersCount:h.length}},preprocess:function(a,b){var c,d,e,f,g,h=a.getSyncIndex(),i=this,j=0;if(this._sync)return void i.updateChildren(a,b,this._el);if(this._template=this._template||this._children,this._childrenEach=!0,a._serverData&&(d=a._serverData[fb.id(this)],a._serverData[fb.id(this)]=void 0,d)){var l=document.createElement("div");l.innerHTML=d,i._template=i._children=u(l.childNodes[0],i)}if(e=X.each._getStaticHtml(a,i),g=e.header,k.isObservable(b)&&(d=fb.data(i),d.eachData={id:b.__id__,element:i,startOffset:e.headersCount,endOffset:e.footersCount}),c=k.unwrapObservable(b),f=a._context.childs=[],k.isArray(c))for(j=0;j<c.length;j++)a.dataIndex(k.observable.getIndex(b,j)),f.push(a.pushContext(c[j])),g+=this.renderChildren(a,h+j),a.popContext(),a.dataIndex(void 0);else if(k.isObject(c))for(var m in c)a.dataIndex(k.observable.getIndex(b,j)),a.pushContext(c[m]),g+=i.renderChildren(a),a.popContext(),a.dataIndex(void 0),j++;this.html(g+e.footer)}},options:{passDomQuery:!0,passRawValues:!0,preprocess:function(a,b,c){c=c||{};for(var d,e="$this",f=lb.Create("{{"+(c.text||e)+"}}"),g=lb.Create("{{"+(c.value||e)+"}}","value"),h=k.isString(c.caption)&&new m("option"),i=new m("option"),j=this._children,l=0;l<j.length;l++)d=j[l],(!d._attributes||d._attributes&&!d._attributes["data-role"])&&j.splice(l--,1);i._attributeExpressions.push(g),i._children.push(f),i._parent=this,this._children.push(i),h&&(h._attributes["data-role"]="header",h._innerHTML=c.caption,this.addChild(h)),k.queries.each.preprocess.call(this,a,b)}},render:{passDetailValues:!0,preprocess:function(a){if(!this._each&&!this._sync)throw new Error("render() is supported only() in each context");this._renderMode=a.value?m.RenderMode.All:m.RenderMode.None,a.containsObservable&&this._renderMode==m.RenderMode.None&&(this._renderMode=m.RenderMode.ElementOnly,this.css("display","none"),fb.data(this,"renderCache",this))},update:function(a){var b=fb.data(this);b.renderCache&&a.value&&(this.innerHTML=b.renderCache.renderChildren(k.domQuery(this)),k.domQuery(this).createElementObservableDependencies(this.childNodes),b.renderCache=null),this.style.display=a.value?"":"none"}},updateOn:{preprocess:function(a){fb.data(this).updateOn=a}},animate:{preprocess:function(a){fb.data(this).animateCallback=a}},setClass:{preprocess:function(a,b){arguments.length>1?this.toggleClass(a,!!b):this.addClass(a)},update:function(a,b){var c=fb.data(this).virtual;c._each&&(c=m(),c._el=this),arguments.length>1?c.toggleClass(a,b):c.addClass(a)}},html:{call:!0},text:{call:!0},visible:{call:"css",prefix:"display"},attr:{passRawValues:!0,call:!0},val:{passRawValues:!0,call:"attr",prefix:"value"},checked:{passRawValues:!0,call:"attr"},disabled:{passRawValues:!0,call:"attr"},css:{call:!0},width:{call:"css"},height:{call:"css"},focused:{preprocess:k.noop,update:function(a){a&&this.focus()}},on:{ready:function(a,b,c){if(a&&b){b=k.toArray(b);var d=this,e=function(a){var d=k.context(this),e=d.$template||d.$view||d.$root;k.each(b,function(b){b.call(e,a,c)})};a=k.isArray(a)?a:a.toString().split(" "),k.each(a,function(a){f(d,a,e)})}}}}),k.each(["click","dblclick","mousedown","mouseup","mouseover","mousemove","mouseout","select","change","submit","reset","focus","blur","keydown","keypress","keyup"],function(a){k.queries[a]={passRawValues:!0,ready:function(b,c){k.queries.on.ready.call(this,a,b,c)}}});var rb="__blocks.observable__";B.prototype={dispose:function(){this.childNodesCount=void 0,this.startIndex=0,this.observableLength=void 0,this.startOffset=0,this.endOffset=0},setStartIndex:function(a){this.startIndex=a+this.startOffset},setChildNodesCount:function(a){void 0===this.childNodesCount&&(this.observableLength=this.observable.__value__.length),this.childNodesCount=a-(this.startOffset+this.endOffset)},chunkLength:function(a){var b,c=this.chunkLengths,d=fb.id(a),e=c[d]||(this.childNodesCount||a.childNodes.length)/(this.observableLength||this.observable.__value__.length);return b=k.isNaN(e)||1/0===e?0:Math.round(e),c[d]=b,b},getAt:function(a,b){for(var c=this.chunkLength(a),d=a.childNodes,e=[],f=0;c>f;f++)e[f]=d[b*c+f+this.startIndex];return e},insertAt:function(a,b,c){ob.insert(a,this.chunkLength(a)*b+this.startIndex,k.isArray(c)?c:[c])},removeAt:function(a,b){var c=this.chunkLength(a);ob.remove(a,c*b+this.startIndex,c)},remove:function(a,b){var c=this;this.each(function(d){for(var e=0;b>e;e++)c.removeAt(d,a)}),fb.collectGarbage(),this.dispose(),this.observable._indexes.splice(a,b)},removeAll:function(){var a=this,b=this.observable.__value__;this.each(function(c){k.each(b,function(){a.removeAt(c,0)})})},add:function(a,b){var c=this,d=this.observable;k.each(a,function(a,c){d._indexes.splice(b+c,0,k.observable(b+c))}),this.each(function(e,f){var g,h=k.domQuery(e),i=k.context(e),j="";if(h.contextBubble(i,function(){g=h.getSyncIndex();for(var c=0;c<a.length;c++)h.dataIndex(k.observable.getIndex(d,c+b,!0)),i.childs.splice(c+b,0,h.pushContext(a[c])),j+=f.renderChildren(h,g+(c+b)),h.popContext(),h.dataIndex(void 0)}),0===e.childNodes.length)ib.html(e,j),h.createElementObservableDependencies(e.childNodes);else{var l=h.createFragment(j);c.insertAt(e,b,l)}}),this.dispose()},each:function(a){for(var b=0,c=this.observable._elements;b<c.length;b++){var d=c[b];d.element||(d.element=fb.data(d.elementId).dom),this.setup(d.element,a)}},setup:function(a,b){if(a){var c,d,e,f,g=fb.data(a).eachData;if(g&&g.id==this.observable.__id__)if(c=g.element,this.startOffset=g.startOffset,this.endOffset=g.endOffset,1==a.nodeType)this.setStartIndex(0),this.setChildNodesCount(a.childNodes.length),b(a,c,a);else{for(d=fb.id(a),f=a.parentNode.firstChild,e=0;f!=a;)f=f.nextSibling,e++;for(this.setStartIndex(e+1);f&&(8!=f.nodeType||1!=f.nodeValue.indexOf(d+":/blocks"));)f=f.nextSibling,e++;this.setChildNodesCount(e-this.startIndex),b(a.parentNode,c,a)}}}};var sb=1;k.observable=function(a,b){var c=function(a){0===arguments.length&&U.trigger(c,"get",c);var b=E(c),d=c.update;return 0===arguments.length?(kb.registerObservable(c),b):(k.equals(a,b,!1)||U.trigger(c,"changing",a,b)===!1||(c.update=k.noop,c._dependencyType?2==c._dependencyType&&c.__value__.set.call(c.__context__,a):k.isArray(b)&&k.isArray(a)&&c.reset?c.reset(a):c.__value__=a,c.update=d,c.update(),U.trigger(c,"change",a,b)),c)};return a=k.unwrap(a),k.extend(c,k.observable.fn.base),c.__id__=sb++,c.__value__=a,c.__context__=b||k.__viewInInitialize__||c,c._expressionKeys={},c._expressions=[],c._elementKeys={},c._elements=[],k.isArray(a)?(k.extend(c,k.observable.fn.array),c._indexes=[],c._chunkManager=new B(c)):k.isFunction(a)?c._dependencyType=1:a&&k.isFunction(a.get)&&k.isFunction(a.set)&&(c._dependencyType=2),C(c),c};var tb={};k.extend(k.observable,{getIndex:function(a,b,c){if(!k.isObservable(a))return tb[b]||(tb[b]=k.observable(b)),tb[b];var d,e=a._indexes;return e?e.length==a.__value__.length||c?d=e[b]:(d=k.observable(b),e.splice(b,0,d)):d=k.observable(b),d},fn:{base:{__identity__:rb,update:function(){var a,b,c,d,e,f,g=this._elements;k.eachRight(this._expressions,function(b){d=b.element,c=b.context,d||(a=fb.data(b.elementId),d=b.element=a.dom);try{f=k.unwrap(jb[b.expression](c))}catch(g){f=""}f=null==f?"":f.toString(),e=b.length-f.length,b.length=f.length,d?b.attr?d.setAttribute(b.attr,lb.GetValue(c,null,b.entire)):d.nextSibling?(d=d.nextSibling,d.nodeValue=f+d.nodeValue.substring(b.length+e)):d.parentNode.appendChild(document.createTextNode(f)):(d=a.virtual,b.attr&&d.attr(b.attr,lb.GetValue(c,null,b.entire)))});for(var h=0;h<g.length;h++)f=g[h],d=f.element,!d&&fb.data(f.elementId)&&(d=f.element=fb.data(f.elementId).dom,d||(d=fb.data(f.elementId).virtual)),m.Is(d)||document.body.contains(d)?(b=k.domQuery(d),b.contextBubble(f.context,function(){b.executeMethods(d,f.cache)})):(g.splice(h,1),h-=1);return k.each(this._dependencies,function(a){C(a),a.update()}),k.each(this._indexes,function(a,b){a(b)}),this},on:function(a,b,c){return U.on(this,a,b,c||this.__context__),this},once:function(a,b,c){return U.once(this,a,b,c||this.__context__),this},off:function(a,b){return U.off(this,a,b),this},extend:function(a){var b,c=k.observable[a];return 0===arguments.length?(k.core.expressionsCreated&&k.core.applyExpressions(k.type(this()),this),this):c?(b=c.apply(this,k.toArray(arguments).slice(1)),k.isObservable(b)?b:this):void 0},clone:function(a){var b=this.__value__;return k.observable(a?k.clone(b):b,this.__context__)},toString:function(){var a=this.__context__,b=1==this._dependencyType?this.__value__.call(a):2==this._dependencyType?this.__value__.get.call(a):this.__value__;return kb.registerObservable(this),null!=b&&k.isFunction(b.toString)?b.toString():String(b)}},array:{reset:function(a){if(0===arguments.length)return this.removeAll(),this;a=k.unwrap(a);var b=this.__value__,c=this._chunkManager,d=Math.max(a.length-b.length,0),e=Math.max(b.length-a.length,0),f=a.length-d;return U.trigger(this,"removing",{type:"removing",items:b,index:0}),U.trigger(this,"adding",{type:"adding",items:a,index:0}),c.each(function(b,c){var d=k.domQuery(b);d.contextBubble(k.context(b),function(){c.updateChildren(a,f,d,b)})}),d>0?c.add(a.slice(b.length),b.length):e>0&&c.remove(a.length,e),this.__value__=a,U.trigger(this,"remove",{type:"remove",items:b,index:0}),U.trigger(this,"add",{type:"add",items:a,index:0}),this},add:function(a,b){return this.splice(k.isNumber(b)?b:this.__value__.length,0,a),this},addMany:function(a,b){return this.splice.apply(this,[k.isNumber(b)?b:this.__value__.length,0].concat(k.toArray(a))),this},swap:function(a,b){var c,d=this(),e=this._elements,f=this._chunkManager;k.swap(d,a,b);for(var g=0;g<e.length;g++)c=e[g].element,a>b?(f.insertAt(c,a,f.getAt(c,b)),f.insertAt(c,b,f.getAt(c,a))):(f.insertAt(c,b,f.getAt(c,a)),f.insertAt(c,a,f.getAt(c,b)));return this},move:function(a,b){var c,d=this(),e=this._elements,f=this._chunkManager;k.move(d,a,b),b>a&&b++;for(var g=0;g<e.length;g++)c=e[g].element,f.insertAt(c,b,f.getAt(c,a));return this},remove:function(a,b){return this.removeAll(a,b,!0)},removeAt:function(a,b){return k.isNumber(b)||(b=1),this.splice(a,b),this},removeAll:function(a,b,c){var d,e,f=this.__value__,g=this._chunkManager;if(0===arguments.length)(U.has(this,"removing")||U.has(this,"remove"))&&(d=k.clone(f)),U.trigger(this,"removing",{type:"removing",items:d,index:0}),g.removeAll(),this._indexes=[],d=f.splice(0,f.length),U.trigger(this,"remove",{type:"remove",items:d,index:0});else{var h,i=k.isFunction(a);for(e=0;e<f.length&&(h=f[e],!(h===a||i&&a.call(b,h,e,f))||(this.splice(e,1),e-=1,!c));e++);}return this.update(),this},concat:function(){var a=this();return a.concat.apply(a,k.toArray(arguments))},slice:function(a,b){return arguments.length>1?this().slice(a,b):this().slice(a)},join:function(a){return arguments.length>0?this().join(a):this().join()},pop:function(){var a=this,b=a();return a.splice(b.length-1,1)[0]},push:function(){return this.addMany(arguments),this.__value__.length},reverse:function(){var a=this().reverse(),b=this._chunkManager;return this._indexes.reverse(),b.each(function(c){for(var d=1;d<a.length;d++)b.insertAt(c,0,b.getAt(c,d))}),this.update(),a},shift:function(){return this.splice(0,1)[0]},sort:function(a){for(var b,c,d=this.__value__,e=d.length,f=arguments.length>0,g=this._chunkManager,h=this._indexes,i=0;e>i;i++){var j=[d[i],i];g.each(function(a){j.push(g.getAt(a,i))}),d[i]=j}for(d.sort(function(b,c){return b=b[0],c=c[0],f?a.call(this,b,c):c>b?-1:b>c?1:0}),h.length>0&&(this._indexes=[]),i=0;e>i;i++)c=d[i],h.length>0&&this._indexes.push(h[c[1]]),b=2,g.each(function(a){g.insertAt(a,e,c[b]),b++}),d[i]=c[0];return this.update(),d},splice:function(a,b){var c,d=this.__value__,e=this._chunkManager,f=[],g=arguments;return a=0>a?d.length-a:a,b&&a<d.length&&a>=0&&(b=Math.min(d.length-a,b),f=d.slice(a,a+b),U.trigger(this,"removing",{type:"removing",items:f,index:a}),e.remove(a,b),f=d.splice(a,b),U.trigger(this,"remove",{type:"remove",items:f,index:a})),g.length>2&&(c=k.toArray(g),c.splice(0,2),U.trigger(this,"adding",{type:"adding",index:a,items:c}),e.add(c,a),d.splice.apply(d,[a,0].concat(c)),U.trigger(this,"add",{type:"add",index:a,items:c})),this.update(),f},unshift:function(){return this.addMany(arguments,0),this.__value__.length}}}});var ub={waiting:{},initExpressionExtender:function(a){var b=a.clone();return b.view=k.observable([]),b.view._connections={},b.view._observed=[],b.view._updateObservable=k.bind(ub.updateObservable,b),b._operations=a._operations?k.clone(a._operations):[],b._getter=k.bind(ub.getter,b),b.view._initialized=!1,b.view.on("get",b._getter),b.on("add",function(){b.view._initialized&&(b.view._connections={},b.view.reset(),ub.executeOperations(b))}),b.on("remove",function(){b.view._initialized&&(b.view._connections={},b.view.reset(),ub.executeOperations(b))}),b},getter:function(){U.off(this.view,"get",this._getter),this._getter=void 0,this.view._initialized=!0,ub.executeOperationsPure(this)},updateObservable:function(){ub.executeOperations(this)},executeOperationsPure:function(a){var b=[],c=a.view._observed,d=a.view._updateObservable;k.each(c,function(a){U.off(a,"change",d)}),c=a.view._observed=[],kb.startObserving(),k.each(a._operations,function(c){if("step"==c.type){var d=a.view;a.view=k.observable([]),a.view._connections={},b.length&&ub.executeOperationsChunk(a,b),c.step.call(a.__context__),a.view=d}else b.push(c)}),b.length&&ub.executeOperationsChunk(a,b),k.each(kb.stopObserving(),function(a){c.push(a),a.on("change",d)})},executeOperations:function(a){var b=a.__id__,c=ub.waiting;c[b]||(c[b]=!0,setTimeout(function(){ub.executeOperationsPure(a),c[b]=!1},0))},executeOperationsChunk:function(a,b){var c="add",d="remove",e="exists",f=e,g=a.__value__,h=a.view,i=h._connections,j={},l=0,m=h.update,n=0,o=g.length;h.update=k.noop,k.each(b,function(c){"skip"==c.type?(n=c.skip,k.isFunction(n)&&(n=n.call(a.__context__)),n=k.unwrap(n)):"take"==c.type?(o=c.take,k.isFunction(o)&&(o=o.call(a.__context__)),o=k.unwrap(o)):"sort"==c.type&&(g=k.isString(c.sort)?k.clone(g).sort(function(a,b){return a[c.sort]-b[c.sort]}):k.isFunction(c.sort)?k.clone(g).sort(c.sort):k.clone(g).sort(),1==b.length&&b.push({type:"filter",filter:function(){return!0}}))}),k.each(g,function(m,p){if(0>=o){for(;h().length-l>0;)h.removeAt(h().length-1);return!1}switch(k.each(b,function(b){var h=b.filter;if(f=void 0,h){if(!h.call(a.__context__,m,p,g))return f=void 0,void 0!==i[p]&&(f=d),!1;f=e,void 0===i[p]&&(f=c)}else if("skip"==b.type){if(f=e,n-=1,n>=0)return f=d,!1;0>n&&void 0===i[p]&&(f=c)}else if("take"==b.type){if(0>=o)return f=d,!1;o-=1,f=e,void 0===i[p]&&(f=c)}}),f){case c:j[p]=l,h.splice(l,0,m),l++;break;case d:h.removeAt(l);break;case e:j[p]=l,l++}}),h._connections=j,h.update=m,h.update()}};k.observable.filter=function(a){var b=ub.initExpressionExtender(this),c=a;return(!k.isFunction(c)||k.isObservable(c))&&(c=function(b){var c=k.unwrap(a),d=String(c).toLowerCase();return b=String(k.unwrap(b)).toLowerCase(),!c||-1!=b.indexOf(d)}),b._operations.push({type:"filter",filter:c}),b},k.observable.step=function(a){var b=ub.initExpressionExtender(this);return b._operations.push({type:"step",step:a}),b},k.observable.skip=function(a){var b=ub.initExpressionExtender(this);return b._operations.push({type:"skip",skip:a}),b},k.observable.take=function(a){var b=ub.initExpressionExtender(this);return b._operations.push({type:"take",take:a}),b},k.observable.sort=function(a){var b=ub.initExpressionExtender(this);return b._operations.push({type:"sort",sort:a}),b},k.query=function(a,b){k.domReady(function(){k.$unwrap(b,function(b){k.isElement(b)||(b=document.body);var c=new z,d=u(b)[0],e=window.__blocksServerData__;c.pushContext(a),c._serverData=e,e?d.render(c):d.sync(c),c.createElementObservableDependencies([b])})})},k.executeQuery=function(a,b){var c=m.Is(a)?"preprocess":"update",d=Array.prototype.slice.call(arguments,2),e=k.queries[b];e.passDomQuery&&d.unshift(k.domQuery(a)),e[c].apply(a,d)},k.context=function(a,b){if(a=k.$unwrap(a)){var c=fb.data(a);if(c){if(b&&c.childrenContext)return c.childrenContext;if(c.context)return c.context}return k.context(m.Is(a)?a._parent:a.parentNode,!0)}return null},k.dataItem=function(a){var b=k.context(a);return b?b.$this:null},k.isObservable=function(a){return!!a&&a.__identity__===rb},k.unwrapObservable=function(a){return a&&a.__identity__===rb?a():a},k.domQuery=function(a){if(a=k.$unwrap(a)){var b=fb.data(a,"domQuery");return b?b:k.domQuery(m.Is(a)?a._parent:a.parentNode)}return null},k.extend(k.queries,{view:{passDomQuery:!0,preprocess:function(a,b){b.isActive()?(this.css("display",""),b._html&&k.queries.template.preprocess.call(this,a,b._html,b)):this.css("display","none"),X["with"].preprocess.call(this,a,b,"$view")},update:function(a,b){b.isActive()?(b._html&&(X["with"].preprocess.call(this,a,b,"$view"),this.innerHTML=b._html,b._children=b._html=void 0,k.each(u(this.childNodes[0]),function(b){m.Is(b)&&b.sync(a)}),a.createElementObservableDependencies(this.childNodes)),ob.show(this)):ob.hide(this)}},navigateTo:{update:function(a,b){function c(c){c=c||window.event,c.preventDefault(),c.returnValue=!1,k.isString(a)?window.location.href=a:a.navigateTo(a,b)}f(this,"click",c)}},trigger:{}});var vb={required:{priority:9,validate:function(a,b){return a!==b.defaultValue&&""!==a&&a!==!1&&void 0!==a&&null!==a?!0:void 0}},minlength:{priority:19,validate:function(a,b,c){return void 0===a||null===a?!1:a.length>=parseInt(c,10)}},maxlength:{priority:29,validate:function(a,b,c){return void 0===a||null===a?!0:a.length<=parseInt(c,10)}},min:{priority:39,validate:function(a,b,c){return void 0===a||null===a?!1:a>=c}},max:{priority:49,validate:function(a,b,c){return void 0===a||null===a?!1:c>=a}},email:{priority:59,validate:function(a){return/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(a)}},url:{priority:69,validate:function(a){return/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/.test(a)}},date:{priority:79,validate:function(a){return a?!/Invalid|NaN/.test(new Date(a.toString()).toString()):!1}},creditcard:{priority:89,validate:function(a){if(k.isString(a)&&0===a.length)return!1;if(k.isNumber(a)&&(a=a.toString()),/[^0-9 \-]+/.test(a))return!1;var b=0,c=0,d=!1;a=a.replace(/\D/g,"");for(var e=a.length-1;e>=0;e--){var f=a.charAt(e);c=parseInt(f,10),d&&(c*=2)>9&&(c-=9),b+=c,d=!d}return b%10===0}},regexp:{priority:99,validate:function(a,b,c){return k.isRegExp(c)?void 0===a||null===a?!1:c.test(a):!1}},number:{priority:109,validate:function(a){return k.isNumber(a)?!0:k.isString(a)&&0===a.length?!1:/^(-?|\+?)(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(a)}},digits:{priority:119,validate:function(a){return/^\d+$/.test(a)}},letters:{priority:129,validate:function(a){return a?/^[a-zA-Z]+$/.test(a):!1}},equals:{priority:139,validate:function(a,b,c){return k.equals(a,k.unwrap(c))}}};k.observable.validation=function(a){var b,c,d=this,e=a.maxErrors,f=this.errorMessages=k.observable([]),g=this._validators=[];this.errorMessage=k.observable("");for(b in a)c=a[b],vb[b]?g.push({option:c,validate:vb[b].validate,priority:vb[b].priority}):("validate"==b||"asyncValidate"==b)&&g.push({option:"",validate:c.validate?c.validate:c,priority:c.priority||Number.POSITIVE_INFINITY,isAsync:"asyncValidate"==b});g.sort(function(a,b){return a.priority>b.priority?1:-1}),this.valid=k.observable(!0),this.validate=function(){var b,h,i,j=d.__value__,l=!0,m=0,n=0;for(f.removeAll();n<g.length&&!(m>=e);n++){if(h=g[n],h.isAsync)return h.validate(j,function(b){F(d,a,!!b)}),!0;b=h.option,c=h.option,k.isPlainObject(b)&&(c=b.value),k.isFunction(c)&&(c=c.call(d.__context__)),i=h.validate(j,a,c),k.isString(i)&&(i=[i]),(k.isArray(i)||!i)&&(f.addMany(k.isArray(i)?i:b&&b.message?[b.message]:c&&k.isString(c)?[c]:[]),l=!1,m++)}return F(this,a,l),this.valid(l),U.trigger(this,"validate"),l},a.validateOnChange&&this.on("change",function(){this.validate()}),a.validateInitially&&this.validate()},k.route=function(a){return H(a)},H.Is=function(a){return H.prototype.isPrototypeOf(a)},H.Has=function(a){return null!=a._routeString},H.Combine=function(a,b){if(!H.Has(b))return a;if(!H.Has(a))return b;
var c=H(a+b);return k.extend(c._wildcard,a._wildcard,b._wildcard),k.extend(c._optional,a._optional,b._optional),k.extend(c._validate,a._validate,b._validate),c},H.prototype={wildcard:function(){var a=this._wildcard,b=k.flatten(k.toArray(arguments));return k.each(b,function(b){a[b]=!0}),this},optional:function(a,b){return this._addMetadata("optional",a,b),this},validate:function(a,b){return this._addMetadata("validate",a,b),this},transform:function(a,b){return this._addMetadata("_transform",a,b),this},toString:function(){return this._routeString?this._routeString.toString():""},trailingSlash:function(){return this},_transfromParam:function(a,b){var c=this._transform[a];return""===b&&k.has(this._optional,a)&&(b=this._optional[a]),c?c(b):b},_validateParam:function(a,b){var c=this._validate[a];return c?c(b):!0},_addMetadata:function(a,b,c){var d=this["_"+a];k.isPlainObject(b)?k.each(b,function(a,b){d[b]=a}):k.isString(b)&&(d[b]=c)}},k.core.Router=I,I.GenerateRoute=function(a,b){var c=new I,d=c.registerRoute(a),e=c.routeTo(d,b);return 0===a.indexOf("/")&&0!==e.indexOf("/")?"/"+e:e},I.prototype={registerRoute:function(a,b){a=H(a),b=H(b?this._routes[H(b).toString()].route:void 0);var c=H.Combine(b,a),d=c._routeString=c._routeString.replace(/^\//,""),e=this._generateRouteStringData(d);return this._routes[d]={route:c,data:e,regExCollection:this._generateRouteRegEx(c,e),parent:H.Has(b)?this._routes[b.toString()]:void 0},d},routeTo:function(a,b){var c,d=this._routes[a],e=d.route,f="";return b=b||{},k.each(d.data,function(a){c=a.param,c?e._validateParam(b[c])&&(f+=k.has(b,c)?b[c]:e._optional[c]):f+=a.string}),f},routeFrom:function(a){var b,c=this._getUrlParams,d=[];return a=decodeURI(a),k.each(this._routes,function(e){k.each(e.regExCollection,function(f){if(f.regEx.test(a)){for(b=f.regEx.exec(a);e;)d.unshift({id:e.route._routeString,params:c(e,f.params,b)}),e=e.parent;return!1}})}),d.length?d:null},_getUrlParams:function(a,b,c){var d,e,f=a.route,g={};return k.each(b,function(a,b){d=c[b+1],f._validateParam(a,d)&&(g[a]=f._transfromParam(a,d))}),k.each(a.data,function(a){e=a.param,e&&!g[e]&&k.has(f._optional,e)&&void 0!==f._optional[e]&&(g[e]=f._optional[e])}),g},_generateRouteRegEx:function(a,b){var c,d,e,f,g,h=[],i=this._sliceLastFromRegExString,j=this._getOptionalParametersCombinations(a,b);return k.each(j,function(j){e="^",f=[],k.each(b,function(b){if(g=b.param){if(d=!0,k.has(a._optional,g)&&j[g]||(c=!1),j[g])return;f.push(g),e+=a._wildcard[g]?k.has(a._optional,g)?"(.*?)":"(.+?)":k.has(a._optional,g)?"([^/]*?)":"([^/]+?)"}else"/"==b.string&&(d&&c&&(e=i(e)),d=!1,c=!0),e+=G(b.string)}),d&&c&&(e=i(e)),h.push({regEx:new RegExp(e+"$","i"),params:f})}),h},_sliceLastFromRegExString:function(a){for(var b,c=0;c<a.length&&(b=a.length-c-1,"/"!=a.charAt(b)||"]"==a.charAt(b+1));c++);return a.substring(0,b-1)},_getOptionalParametersCombinations:function(a,b){var c,d,e,f=this._getOptionalParameters(a,b),g=Math.pow(2,f.length),h=f.length,i=[{}];for(d=0;g>d;d++){for(c={},c.__lowestIndex__=h,c.__length__=0,e=0;h>e;e++)d&Math.pow(2,e)&&(e<c.__lowestIndex__&&(c.__lowestIndex__=e),c[f[e]]=!0,c.__length__+=1);c.__length__&&i.push(c)}return i.sort(function(a,b){var c=a.__length__-b.__length__;return c?c:b.__lowestIndex__-a.__lowestIndex__}),i},_getOptionalParameters:function(a,b){var c=[];return k.each(b,function(b){k.has(a._optional,b.param)&&c.push(b.param)}),c},_generateRouteStringData:function(a){var b=this._pushStringData,c=[],d=0;return a.replace(/{{[^}]+}}/g,function(e,f){b(c,a.substring(d,f)),d=f+e.length,c.push({param:e.substring(2,e.length-2)})}),d!=a.length&&b(c,a.substring(d)),c},_pushStringData:function(a,b){var c=b.split("/");k.each(c,function(b,d){b&&a.push({string:b}),d!=c.length-1&&a.push({string:"/"})})}};var wb=function(){var a=Date.now();return function(){return"blocks-"+k.version+"-"+a++}}();J.Execute=function(a){return new J(a)},J.Defaults={type:"GET",url:"",processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",jsonp:"callback",jsonpCallback:function(){return wb()}},J.Accepts={"*":"*/".concat("*"),text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},J.Meta={statusFix:{0:200,1223:204}},J.prototype={execute:function(){var a=this.options,b=window.__blocksServerData__;if("GET"==a.type&&a.data&&this.appendDataToUrl(a.data),b&&b.requests&&b.requests[a.url])this.callSuccess(b.requests[a.url]);else try{"jsonp"==a.dataType?this.scriptRequest():this.xhrRequest()}catch(c){}},xhrRequest:function(){var a=this.options,b=this.createXHR();b.onabort=k.bind(this.xhrError,this),b.ontimeout=k.bind(this.xhrError,this),b.onload=k.bind(this.xhrLoad,this),b.onerror=k.bind(this.xhrError,this),b.open(a.type.toUpperCase(),a.url,a.async,a.username,a.password),b.setRequestHeader("Content-Type",a.contentType),b.setRequestHeader("Accept",J.Accepts[a.dataType||"*"]),b.send(a.data||null)},createXHR:function(){var a=XMLHttpRequest||window.ActiveXObject;try{return new a("Microsoft.XMLHTTP")}catch(b){}},xhrLoad:function(a){var b=a.target,c=J.Meta.statusFix[b.status]||b.status,d=c>=200&&300>c||304===c;d?this.callSuccess(b.responseText):this.callError(b.statusText)},xhrError:function(){this.callError()},scriptRequest:function(){var a=this,b=this.options,c=document.createElement("script"),d={},e=k.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback;d[b.jsonp]=e,this.appendDataToUrl(d),window[e]=function(b){window[e]=null,a.scriptLoad(b)},c.onerror=this.scriptError,c.async=b.async,c.src=b.url,document.head.appendChild(c)},scriptLoad:function(a){this.callSuccess(a)},scriptError:function(){this.callError()},appendDataToUrl:function(a){var b=this,c=this.options,d=/\?/.test(c.url);k.isPlainObject(a)?k.each(a,function(a,e){c.url+=b.append(d,e,a.toString())}):k.isArray(a)?k.each(a,function(a,c){b.appendDataToUrl(c)}):c.url+=b.append(d,a.toString(),"")},append:function(a,b,c){var d=a?"&":"?";return d+=b,c&&(d+="="+c),d},callSuccess:function(a){var b=this.options.success,c="success";b&&b(a,c,null),this.callComplete(c)},callError:function(a){var b=this.options.error,c="error";b&&b(null,c,a),this.callComplete(c)},callComplete:function(a){var b=this.options.complete;b&&b(null,a)}};var xb="create",yb="update",zb="destroy",Ab="GET",Bb="application/json; charset=utf-8",Cb=["change","sync","error","requestStart","requestEnd"];k.DataSource=L,L.ArrayMode=1,L.ObjectMode=2,L.prototype={options:{baseUrl:"",idAttr:"",mode:L.ArrayMode,read:{url:"",type:Ab,contentType:Bb},update:{url:"",type:"POST",contentType:Bb},create:{url:"",type:"POST",contentType:Bb},destroy:{url:"",type:"POST",contentType:Bb}},read:function(a,b){var c=this;return b=arguments[arguments.length-1],k.isFunction(a)&&(a={}),a=a||{},c._ajax("read",a,function(d){k.isString(d)&&(d=JSON.parse(d)),c.options.mode==L.ArrayMode&&(k.isArray(d)||(k.isArray(d.value)?d=d.value:k.isObject(d)&&k.each(d,function(a){return k.isArray(a)?(d=a,!1):void 0}))),k.isArray(d)||(d=[d]),a&&a.__updateData__===!1||c._updateData(d),b&&k.isFunction(b)&&b(d)}),c},update:function(){if(0!==arguments.length){var a;arguments.length>1&&k.type(arguments[0])!=k.type(arguments[1])?(a=[arguments[1]],a[0][this.options.idAttr]=arguments[0]):a=k.flatten(arguments),a.length>0&&(this._changes.push({type:yb,items:a}),this._onChangePush())}},hasChanges:function(){return this._changes.length>0},clearChanges:function(){return this._changes.splice(0,this._changes.length),this._changesMeta={},this.hasChanges(!1),this},sync:function(){var a,b=this,c=this._changes,d=c.length;return k.each(c,function(c){k.each(c.items,function(e){a=e,e.__id__&&delete e.__id__,b._ajax(c.type,{data:a},function(){d--,d||b._trigger("sync")})})}),this.clearChanges()},_ajax:function(a,b,c){var d,e=this;b=k.extend({},this.options[a],b),d=b.type.toUpperCase(),b.url=I.GenerateRoute(b.url,b.data),this._trigger("requestStart",{}),K({type:b.type,url:b.url,data:d==Ab?null:JSON.stringify(b.data),contentType:b.contentType,dataType:b.dataType,jsonp:b.jsonp,success:function(a,b,d){e._trigger("requestEnd",{}),a&&c(a,b,d)},error:function(){e._trigger("requestEnd",{}),e._trigger("error")}})},_updateData:function(a){this.data.removeAll(),this.data.addMany(a),this.clearChanges(),this._trigger("change")},_onArrayChange:function(a){var b=a.type;"remove"==b?this._remove(a.items):"removeAt"==b?this._remove(this.data.slice(a.index,a.index+a.count)):"add"==b&&this._add(a.items)},_onChangePush:function(){var a,b=this._changesMeta,c=this._changes,d=c[c.length-1],e=this.options.idAttr,f=d.type;k.each(d.items,function(d){switch(f){case xb:d.__id__=wb(),b[d.__id__]=d;break;case yb:a=b[d[e]],a&&(c.splice(a.index,1),a.item=d,a.index=c.length-1),b[d[e]]={index:c.length-1,item:d};break;case zb:a=b[d?d.__id__:void 0],a&&(c.splice(a.index,1),c.pop(),b[d.__id__]=void 0)}}),c.length>0&&this.options.autoSync?this.sync():this.hasChanges(c.length>0)},_add:function(a){this._changes.push({type:xb,items:a}),this._onChangePush()},_remove:function(a){this._changes.push({type:zb,items:a}),this._onChangePush()},_subscribeToEvents:function(){var a=this,b=this.options;k.each(Cb,function(c){b[c]&&a.on(c,b[c])})}},U.register(L.prototype,["on","_trigger","change","error","requestStart","requestEnd"]),k.core.applyExpressions("array",k.DataSource.prototype,k.toObject(["size","at","isEmpty","each"])),M.Is=function(a){return M.prototype.isPrototypeOf(a)},M.Inflate=function(a){var b,c,d={};for(b in a)c=a[b],M.Is(c)&&(c=c._options,c.propertyName=b,d[c.field||b]=c);return d},M.Create=function(a,b,c){var d;return arguments.length<3&&(c=a.value||a.defaultValue),b=a.thisArg?a.thisArg:b,d=k.observable(c,b).extend("validation",a).on("changing",a.changing,b).on("change",a.change,b),k.each(a.extenders,function(a){d=d.extend.apply(d,a)}),d},M.prototype.extend=function(){var a=this._options;return a.extenders=a.extenders||[],a.extenders.push(k.toArray(arguments)),this},N.prototype={options:{},init:k.noop,collection:function(){return this._collection},validate:function(){var a,b,c=this._properties,d=!0;for(b in c)a=this[b],k.isObservable(a)&&!a.validate()&&(d=!1);return this.valid(d),this._updateValidationErrors(),d},dataItem:function(){var a,b,c=this._properties,d={};for(a in c)b=c[a],"__id__"!=a&&k.isFunction(this[b.propertyName])&&(d[b.field||b.propertyName]=this[b.propertyName]());return this.isNew()&&delete d[this.options.idAttr],d},reset:function(a){return this._ensurePropertiesCreated(a),this},isNew:function(){var a=this.options.idAttr,b=k.unwrap(this[a]),c=this._properties[a];return!b&&0!==b||c&&b===c.defaultValue?!0:!1},read:function(a,b){return k.isFunction(a)&&(b=a,a=void 0),this._dataSource.read({data:a},b),this},destroy:function(a){return a=a===!1?!1:!0,a&&this._collection&&this._collection.remove(this),this._dataSource._remove([this.dataItem()]),this},sync:function(){return this.isNew()&&this._dataSource.add(this.dataItem()),this._dataSource.sync(),this},clone:function(){return new this.constructor(k.clone(this._initialDataItem,!0))},_setPropertyValue:function(a,b){var c=a.propertyName;k.isFunction(this[c])?(this[c](b),this._dataSource.update(this.dataItem())):this[c]=a.isObservable?this._createObservable(a,b):function(){return b}},_ensurePropertiesCreated:function(a){var b,c,d,e=this._properties;if(a){N.prototype.isPrototypeOf(a)&&(a=a.dataItem());for(c in a)b=e[c],b||(b=e[c]=k.extend({},this._application.Property.Defaults()),b.propertyName=c),this._setPropertyValue(b,a[c])}for(c in e)b=e[c],k.has(a,b.propertyName)||(d=b.field||b.propertyName,this._setPropertyValue(b,b.value||(k.has(a,d)?a[d]:b.defaultValue)))},_createObservable:function(a,b){var c=this,d=this._properties,e=M.Create(a,this,b);return e.on("change",function(){c.isNew()||c._dataSource.update(c.dataItem())}).on("validate",function(){var a,b=!0;for(a in d)if(!c[a].valid()){b=!1;break}c._updateValidationErrors(),c.valid(b)}),this._collection||e.extend(),e},_onDataSourceChange:function(){var a=k.unwrapObservable(this._dataSource.data())[0];this._ensurePropertiesCreated(a)},_updateValidationErrors:function(){var a,b,c=this._properties,d=[];for(b in c)a=this[b],a.errorMessages&&d.push.apply(d,a.errorMessages());this.validationErrors.reset(d)}},k.core.expressionsCreated&&k.core.applyExpressions("object",N.prototype);var Db=/^[#\/]|\s+$/g,Eb=/^\/+|\/+$/g,Fb=/msie [\w.]+/,Gb=/\/$/,Hb=/[?#].*$/,Ib="hash",Jb="pushState";P.prototype={start:function(){var a=this._fragment,b=document.documentMode,c=Fb.exec(navigator.userAgent.toLowerCase())&&(!b||7>=b);this._use==Ib&&c&&(this._createIFrame(),this.navigate(a)),this._initEvents(c),this._tryAdaptMechanism(a)||this._loadUrl()},navigate:function(a,b){b&&b!==!0||(b={trigger:!!b});var c=this._root+(a=this._getFragment(a||"")),d=this._use,e=this._iframe,f=this._location;if(a=a.replace(Hb,""),this._fragment===a)return!1;if(this._fragment=a,""===a&&"/"!==c&&(c=c.slice(0,-1)),this._wants==Jb&&d==Jb)this._history[b.replace?"replaceState":"pushState"]({},document.title,c);else{if(d!=Ib)return f.assign(c),!0;this._updateHash(f,a,b.replace),e&&a!==this.getFragment(this._getHash(e))&&(b.replace||e.document.open().close(),this._updateHash(e.location,a,b.replace))}return this._loadUrl(a)},_initEvents:function(a){var b=this._use,c=k.bind(this._onUrlChanged,this);this._wants==Jb&&f(document,"click",k.bind(this._onDocumentClick,this)),b==Jb?f(window,"popstate",c):b==Ib&&!a&&"onhashchange"in window?f(window,"hashchange",c):b==Ib&&(this._checkUrlInterval=setInterval(c,this._interval))},_loadUrl:function(a){var b=this._initial;return this._initial=!1,this._fragment=a=this._getFragment(a),U.trigger(this,"urlChange",{url:a,initial:b})},_getHash:function(a){var b=(a?a.location:this._location).href.match(/#(.*)$/);return b?b[1]:""},_getFragment:function(a){if(null==a)if(this._use==Jb){var b=this._root.replace(Gb,"");a=this._location.pathname,a.indexOf(b)||(a=a.slice(b.length))}else a=this._getHash();return a.replace(this._location.origin,"").replace(Db,"")},_onUrlChanged:function(){var a=this._getFragment();return a===this._fragment&&this._iframe&&(a=this._getFragment(this._getHash(this._iframe))),a===this._fragment?!1:(this._iframe&&this.navigate(a),void this._loadUrl())},_onDocumentClick:function(a){for(var b=a.target;b;){if(b&&b.tagName&&"a"==b.tagName.toLowerCase()){var c,d=b.getAttribute("download");""===d||d||!this._hostRegEx.test(b.href)||a.altKey||a.ctrlKey||a.metaKey||a.shiftKey||2===a.which||this.navigate(b.href)&&(c=document.getElementById(window.location.hash.replace(/^#/,"")),c&&c.scrollIntoView&&c.scrollIntoView(),a.preventDefault());break}b=b.parentNode}},_tryAdaptMechanism:function(a){var b=this._root,c=this._use,d=this._location,e=d.pathname.replace(/[^\/]$/,"$&/")===b;if(this._fragment=a,this._wants==Jb){if(c!=Jb&&!e)return a=this._fragment=this._getFragment(null,!0),d.replace(b+d.search+"#"+a),!0;c==Jb&&e&&d.hash&&(this._fragment=this._getHash().replace(Db,""),this._history.replaceState({},document.title,b+a+d.search))}},_updateHash:function(a,b,c){if(c){var d=a.href.replace(/(javascript:|#).*$/,"");a.replace(d+"#"+b)}else a.hash="#"+b},_createIFrame:function(){var a=document.createElement("iframe");a.style.display="none",a.src="javascript:0",a.tabIndex=-1,document.body.appendChild(a),this._iframe=a.contentWindow},_tryFixOrigin:function(){var a=window.location;a.origin||(a.origin=a.protocol+"//"+a.hostname+(a.port?":"+a.port:""))}},U.register(P.prototype,["on"]),k.observable.remote=function(a){return R(null,{options:a},null,this.__value__)},k.observable.fn.collection={read:function(a,b){var c=this;return k.isFunction(a)&&(b=a,a=void 0),this._dataSource.read({data:a},b?function(){b.call(c.__context__)}:k.noop),this},clearChanges:function(){return this._dataSource.clearChanges(),this},sync:function(){return this._dataSource.sync(),this},update:function(a,b){return 0===arguments.length?this._baseUpdate.call(this):this._dataSource.update(a,b),this},sortBy:function(a,b){if("string"==typeof a){var c=a;a=function(a){return a[c]()}}return k.sortBy(this.__value__,a,b),this},clone:function(){return R(this._Model,this._prototype,this._application,this.__value__)},_onAdding:function(a){var b=this,c=this._Model,d=a.items;k.each(d,function(a,e){N.prototype.isPrototypeOf(a)&&(a=a.dataItem()),d[e]=new c(a,b)})},_onChange:function(a){var b,c=a.type,d=a.items,e=[],f=0;if(!this._internalChanging){for(;f<d.length;f++)b=d[f],b&&("remove"==c||"add"==c&&b.isNew())&&e.push(b.dataItem());"remove"==c?this._dataSource.data.removeAt(a.index,a.items.length):"add"==c&&this._dataSource.data.addMany(e)}},_onDataSourceChange:function(){this._internalChanging=!0,this.reset(this._dataSource.data()),this._internalChanging=!1,this.clearChanges(),this._view&&this._view.trigger("ready")}},S.prototype={init:k.noop,ready:k.noop,routed:k.noop,parentView:function(){return this._parentView},route:function(){return this._application._history.navigate(k.toArray(arguments).join("/")),this},navigateTo:function(a,b){this._application.navigateTo(a,b)},_tryInitialize:function(a){!this._initialized&&a&&(this.options.url&&!this._html?(this._callInit(),this._load()):(this._initialized=!0,this._callInit(),this.isActive()&&this.isActive.update()))},_routed:function(a,b){this._tryInitialize(!0),this.routed(a,b),k.each(this._views,function(c){c.isActive()&&c._routed(a,b)}),this.isActive(!0)},_callInit:function(){if(!this._initCalled){var a,b;k.__viewInInitialize__=this;for(a in this)b=this[a],k.isObservable(b)&&(b.__context__=this);this.init(),k.__viewInInitialize__=void 0,this._initCalled=!0}},_load:function(){var a=this.options.url,b=this._application._serverData;b&&b.views&&b.views[a]&&(a=this.options.url=void 0,this._tryInitialize(!0)),a&&!this.loading()&&(this.loading(!0),K({isView:!0,url:a,success:k.bind(this._loaded,this),error:k.bind(this._error,this)}))},_loaded:function(a){this._html=a,this._tryInitialize(!0),this.loading(!1)},_error:function(){this.loading(!1)}},U.register(S.prototype,["on","off","trigger"]),k.debug.addType("View",function(a){return a&&S.prototype.isPrototypeOf(a)?!0:!1});var Kb;k.Application=function(a){return Kb=Kb||new T(a)},k.core.deleteApplication=function(){Kb=void 0},T.prototype={options:{history:!0},Property:function(a){return k.isString(a)?function(){return this[a]()}:(a=k.extend({},this.Property.Defaults(),a),a=new M(a))},Model:function(a){var b=this,c=function(d,e){return N.prototype.isPrototypeOf(this)?void this._super([b,a,d,e]):new c(d,e)};return a=a||{},a.options=a.options||{},k.inherit(N,c,a)},Collection:function(a,b){var c=this,d=function(e){return Q.prototype.isPrototypeOf(this)?this._super([a,b,c,e]):new d(e)};return a?N.prototype.isPrototypeOf(a.prototype)||(b=a,a=this.Model()):a=this.Model(),b=b||{},b.options=b.options||{},k.inherit(Q,d,b)},View:function(a,b,c){return 1==arguments.length?this._views[a]:void(k.isString(b)?(this._viewPrototypes[b]=this._createView(c),c.options.parentView=a):this._viewPrototypes[a]=this._createView(b))},extend:function(a){return k.extend(this,a),O(a,this),this},navigateTo:function(a,b){return a.options.route?(this._history.navigate(this._router.routeTo(a.options.routeName,b)),!0):!1},start:function(a){this._started||(this._started=!0,this._serverData=window.__blocksServerData__,this._createViews(),k.domReady(k.bind(this._ready,this,a)))},_prepare:function(){k.domReady(function(){setTimeout(k.bind(function(){this.start()},this))},this)},_startHistory:function(){this._history=new P(this.options),this._history.on("urlChange",k.bind(this._urlChange,this)).start()},_ready:function(a){this._serverData=window.__blocksServerData__,this._startHistory(),k.query(this,a),this._viewsReady(this._views)},_viewsReady:function(a){k.each(a,function(a){a.ready!==k.noop&&(a.isActive()?a.ready():a.isActive.once("change",function(){a.loading()?a.loading.once("change",function(){a.ready()}):a.ready()}))})},_urlChange:function(a){var b=this,c=this._currentView,d=this._router.routeFrom(a.url),e=!1;return k.each(d,function(d){return k.each(b._views,function(f){return f.options.routeName==d.id?(!c&&(f.options.initialPreload||a.initial&&b._serverData&&"pushState"==b.options.history)&&(f.options.url=void 0),c&&c!=f&&c.isActive(!1),f._routed(d.params,a),b._currentView=f,e=!0,!1):void 0}),e?!1:void 0}),!e&&c&&c.isActive(!1),e},_createView:function(a){return a.options=k.extend({},this.View.Defaults(),a.options),k.inherit(S,function(b,c){this._super([b,c,a])},a)},_createViews:function(){for(var a,b,c,d,e=k.pairs(this._viewPrototypes),f=this._views,g=[],h=0;0!==e.length;)for(;h<e.length;h++){if(a=e[h],b=a.value,c=b.prototype.options.parentView){if(!this._viewPrototypes[c])throw e.splice(h,1),h--,new Error("View with "+c+"does not exist");f[c]&&(d=new b(this,f[c]),f[c][a.key]=d,f[c]._views.push(d),d.parentView().isActive()||d.isActive(!1),e.splice(h,1),h--)}else d=new b(this),this[a.key]=d,e.splice(h,1),h--,c=void 0;d&&(k.has(d.options,"route")&&(d.options.routeName=this._router.registerRoute(d.options.route,this._getParentRouteName(d))),f[a.key]=d,g.push(d))}for(h=0;h<g.length;h++)g[h]._tryInitialize(g[h].isActive());this._viewPrototypes=void 0},_getParentRouteName:function(a){for(;a;){if(a.options.routeName)return a.options.routeName;a=a.parentView()}},_setDefaults:function(){this.Model.Defaults=k.observable({options:{}}).extend(),this.Collection.Defaults=k.observable({options:{}}).extend(),this.Property.Defaults=k.observable({isObservable:!0,validateOnChange:!1,maxErrors:1,validateInitially:!1}).extend(),this.View.Defaults=k.observable({options:{}}).extend()}}}()}(),function(){var a=k.toString;k.toString=function(b){return 0===arguments.length?"jsblocks - Better MV-ish Framework":a(b)}}();var n=a.blocks;return k.noConflict=function(b){return a.blocks===k&&(a.blocks=n),b&&a.blocks===k&&(a.blocks=n),k},"function"==typeof define&&define.amd&&define("blocks",[],function(){return k}),b!==!0&&(a.blocks=k),k});
//# sourceMappingURL=blocks-mvc.min.js.map